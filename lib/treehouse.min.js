var ve=Object.defineProperty;var Ue=Object.getOwnPropertyDescriptor;var a=(i,e)=>ve(i,"name",{value:e,configurable:!0});var N=(i,e,t,n)=>{for(var o=n>1?void 0:n?Ue(e,t):e,r=i.length-1,s;r>=0;r--)(s=i[r])&&(o=(n?s(e,t,o):s(o))||o);return n&&o&&ve(e,t,o),o};var ke=navigator.userAgent.toLowerCase().indexOf("mac")!==-1;function Y(i){if(!i)return[];let e={backspace:"\u232B",shift:"\u21E7",meta:"\u2318",tab:"\u21B9",ctrl:"\u2303",arrowup:"\u2191",arrowdown:"\u2193",arrowleft:"\u2190",arrowright:"\u2192",enter:"\u23CE"};return i.toLowerCase().split("+").map(ye).map(n=>Object.keys(e).includes(n)?e[n]:n)}a(Y,"bindingSymbols");function ye(i){return!ke&&i==="meta"?"ctrl":i}a(ye,"filterKeyForNonMacMeta");var oe=class{constructor(){this.bindings=[]}registerBinding(e){this.bindings.push(e)}getBinding(e){for(let t of this.bindings)if(t.command===e)return t;return null}evaluateEvent(e){e:for(let t of this.bindings){let n=t.key.toLowerCase().split("+");if(n.pop()===e.key.toLowerCase()){for(let r of["shift","ctrl","alt","meta"]){let s=n.includes(r);if(!ke){if(r==="meta")continue;r==="ctrl"&&(s=n.includes("meta")||n.includes("ctrl"))}let l=e[`${ye(r)}Key`];if(!l&&s||l&&!s)continue e}return t}}return null}};a(oe,"KeyBindings");var re=class{constructor(){this.commands={}}registerCommand(e){this.commands[e.id]=e}canExecuteCommand(e,...t){return this.commands[e]?!(this.commands[e].when&&!this.commands[e].when(...t)):!1}executeCommand(e,...t){return new Promise(n=>{let o=this.commands[e].action(...t);n(o)})}};a(re,"CommandRegistry");var ie=class{constructor(){this.menus={}}registerMenu(e,t){this.menus[e]=t}};a(ie,"MenuRegistry");function be(i,e,t,n){return t?e.disabled||!i.canExecuteCommand(t.id,n):e.disabled}a(be,"isDisabled");var xe={view({attrs:{workbench:i,x:e,y:t,items:n,align:o,commands:r,ctx:s}}){let l=a((d,c)=>h=>{h.stopPropagation(),!be(i,d,c,s)&&(i.closeMenu(),d.onclick&&d.onclick(),c&&i.executeCommand(c.id,s))},"onclick");return m("ul",{class:"menu",style:{margin:"0",display:"inline-block"}},n.filter(d=>!d.when||d.when()).map(d=>{let c="",h,p;return d.command&&(p=r.find(x=>x.id===d.command),h=i.keybindings.getBinding(p.id),c=p.title),d.title&&(c=d.title()),m("li",{onclick:l(d,p),class:be(i,d,p,s)?"disabled":"",style:{display:"flex"}},m("div",null,c),h&&m("div",{class:"keybindings grow text-right"},Y(h.key).join(" ").toUpperCase()))}))}};var G={onupdate({state:i,dom:e}){let t=e.querySelector(".items").children;i.selected!==void 0&&t.length>0&&t[i.selected].scrollIntoView({block:"nearest"})},oncreate({attrs:i,state:e,dom:t}){i.inputview&&t.querySelector("input")?.focus(),e.selected===void 0&&(e.selected=0)},view({attrs:i,state:e}){e.selected=e.selected===void 0?0:e.selected,e.input=e.input===void 0?i.input||"":e.input,e.items===void 0&&(e.items=[],i.onchange(e));let t=a(o=>{let r=a((s,l)=>(s%l+l)%l,"mod");if(o.key==="ArrowDown")return e.selected===void 0?(e.selected=0,!1):(e.selected=r(e.selected+1,e.items.length),!1);if(o.key==="ArrowUp")return e.selected===void 0&&(e.selected=0),e.selected=r(e.selected-1,e.items.length),!1;if(o.key==="Enter")return e.selected!==void 0&&i.onpick(e.items[e.selected]),!1},"onkeydown"),n=a(o=>{e.input=o.target.value,e.selected=0,i.onchange(e)},"oninput");return m("div",{class:"picker"},i.inputview(t,n,e.input),m("div",{class:"items"},e.items.map((o,r)=>m("div",{class:e.selected===r?"item selected":"item",onclick:()=>i.onpick(o),onmouseover:()=>e.selected=r},i.itemview(o,r)))))}};var Ce={view({attrs:{workbench:i,ctx:e}}){let t=a(d=>(d.title||d.id).replace("-"," ").replace(/(^|\s)\S/g,h=>h.toUpperCase()),"getTitle"),n=a((d,c)=>t(d).localeCompare(t(c)),"sort"),o=a(d=>{i.closeDialog(),i.commands.executeCommand(d.id,e)},"onpick"),r=a(d=>{d.items=l.filter(c=>(c.title||c.id).toLowerCase().includes(d.input.toLowerCase()))},"onchange"),s=a(d=>{let c=i.keybindings.getBinding(d.id);return c?Y(c.key).join(" ").toUpperCase():""},"getBindingSymbols"),l=Object.values(i.commands.commands).filter(d=>!d.hidden).filter(d=>i.canExecuteCommand(d.id,e)).sort(n);return m("div",{class:"palette"},m(G,{onpick:o,onchange:r,inputview:(d,c)=>m("div",null,m("input",{style:{width:"98%"},type:"text",onkeydown:d,oninput:c,placeholder:"Enter command..."})),itemview:d=>m("div",{class:"flex"},m("div",null,t(d)),m("div",{class:"keybindings grow text-right"},s(d)))}))}};function J(i,e){return i.value&&i.value[e]instanceof Function}a(J,"hasHook");function Q(i,e,...t){if(J(i,e))return i.value[e].apply(i.value,t)}a(Q,"triggerHook");function H(i,e){for(let t of i.components)if(J(t,e))return!0;return!1}a(H,"objectHas");function se(i,e,...t){for(let n of i.components)if(J(n,e))return n.value[e].apply(n.value,t)}a(se,"objectCall");function X(i,e,...t){let n=[];for(let o of i.components)J(o,e)&&n.push(o.value);return n}a(X,"componentsWith");function B(i){return H(i,"objectChildren")}a(B,"objectManaged");var fe={};function S(i){fe[K(i)]=i}a(S,"component");function K(i){return i.prototype===void 0&&(i=i.constructor),`treehouse.${i.name}`}a(K,"componentName");function Z(i){return typeof i=="string"?fe[i]:fe[K(i)]}a(Z,"getComponent");function Ne(i,e){let t=new(Z(i));return t.fromJSON instanceof Function?t.fromJSON(e):Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)),t}a(Ne,"inflateToComponent");function Se(i){if(i===void 0)return;if(!Z(i))return structuredClone(i);let t=JSON.parse(JSON.stringify(i)||""),n=new i.constructor;return n.fromJSON instanceof Function?n.fromJSON(t):Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)),n}a(Se,"duplicate");var C=class{constructor(){}onAttach(e){this.object=e.parent,this.object.setAttr("view","document")}handleIcon(e=!1){return m("svg",{xmlns:"http://www.w3.org/2000/svg",width:"15",height:"15",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"node-bullet"},m("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),m("polyline",{points:"14 2 14 8 20 8"}),m("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),m("line",{x1:"16",y1:"17",x2:"8",y2:"17"}),m("polyline",{points:"10 9 9 9 8 9"}))}toJSON(e){return{}}static initialize(e){e.commands.registerCommand({id:"make-document",title:"Make Document",action:t=>{if(!t.node)return;let n=new C;t.node.addComponent(n),t.node.changed(),e.executeCommand("zoom",t)}})}};a(C,"Document"),C=N([S],C);var L=class{constructor(){this.text=""}editor(){return Ve}static initialize(e){e.commands.registerCommand({id:"add-description",title:"Add Description",when:t=>!(!t.node||t.path.previous&&B(t.path.previous)||t.node.hasComponent(L)),action:(t,n)=>{let o=new L;t.node.addComponent(o),t.node.changed()}}),e.commands.registerCommand({id:"remove-description",title:"Remove Description",when:t=>!t.node||t.path.previous&&B(t.path.previous)?!1:!!t.node.hasComponent(L),action:(t,n)=>{t.node.removeComponent(L),t.node.changed()}})}};a(L,"Description"),L=N([S],L);var Ve={view({attrs:{node:i}}){let e=a(n=>{let o=i.getComponent(L);o.text=n.target.value,i.changed()},"oninput"),t=a(n=>{i.getComponent(L).text===""&&i.removeComponent(L),i.changed()},"onblur");return m("input",{class:"node-description",placeholder:"Add Description",type:"text",value:i.getComponent(L).text,onblur:t,oninput:e})}};var U={view({attrs:{workbench:i,path:e,onkeydown:t,oninput:n,disallowEmpty:o,editValue:r,placeholder:s},state:l}){let d=e.node,c=r?"value":"name",h=a(()=>c==="name"?H(d,"displayName")?se(d,"displayName",d):d.name:d[c]||"","display"),p=a(()=>{l.initialValue=d[c],i.context.node=d,i.context.path=e},"onfocus"),x=a(()=>d[c],"getter"),A=a((b,g)=>{d.isDestroyed||(o&&b.length===0?d[c]=l.initialValue:d[c]=b),g&&(i.context.node=null)},"setter");d.raw.Rel==="Fields"&&(s=r?"Value":"Field");let v=`input-${e.id}-${d.id}`;c==="value"&&(v=v+"-value");let w=Je;d.parent&&d.parent.hasComponent(C)&&window.Editor&&(w=ze);let f;return d.hasComponent(L)&&(f=d.getComponent(L)),m("div",{class:"node-editor flex flex-col"},m(w,{id:v,getter:x,setter:A,display:h,onkeydown:t,onfocus:p,oninput:n,placeholder:s,workbench:i,path:e}),f?m(f.editor(),{node:d}):null)}},ze={oncreate({dom:i,state:e,attrs:{id:t,onkeydown:n,onfocus:o,onblur:r,oninput:s,getter:l,setter:d,display:c,placeholder:h}}){let p=e.editing?e.buffer:c?c():l(),x=a(f=>{f.key==="Enter"&&(f.preventDefault(),f.stopPropagation())},"defaultKeydown"),A=a(f=>{o&&o(f),e.editing=!0,e.buffer=l()},"startEdit"),v=a(f=>{e.editing&&(e.editing=!1,d(e.buffer,!0),e.buffer=void 0),r&&r(f)},"finishEdit"),w=a(f=>{e.buffer=f.target.value,d(e.buffer,!1),s&&s(f)},"edit");e.editor=new window.Editor(i,p,h),e.editor.onblur=v,e.editor.onfocus=A,e.editor.oninput=w,e.editor.onkeydown=n||x,i.editor=e.editor,i.id=t},onupdate({dom:i,state:e,attrs:{getter:t,display:n}}){e.editor.value=e.editing?e.buffer:n?n():t()},view(){return m("div",{class:"text-editor"})}},Je={oncreate({dom:i,attrs:e}){let t=i.querySelector("textarea"),n=t.offsetHeight,o=i.querySelector("span");this.updateHeight=()=>{o.style.width=`${Math.max(t.offsetWidth,100)}px`,o.innerHTML=t.value.replace(`
`,"<br/>");let r=o.offsetHeight;r===0&&n>0&&(r=n),t.style.height=r>0?`${r}px`:"var(--body-line-height)"},t.addEventListener("input",()=>this.updateHeight()),t.addEventListener("blur",()=>o.innerHTML=""),setTimeout(()=>this.updateHeight(),50),e.onmount&&e.onmount(t)},onupdate(){this.updateHeight()},view({attrs:{id:i,onkeydown:e,onfocus:t,onblur:n,oninput:o,getter:r,setter:s,display:l,placeholder:d,path:c,workbench:h},state:p}){let x=p.editing?p.buffer:l?l():r();return m("div",{class:"text-editor"},m("textarea",{id:i,rows:"1",onfocus:a(g=>{t&&t(g),p.editing=!0,p.buffer=r()},"startEdit"),onblur:a(g=>{p.editing&&(p.editing=!1,s(p.buffer,!0),p.buffer=void 0),n&&n(g)},"finishEdit"),oninput:a(g=>{p.buffer=g.target.value,s(p.buffer,!1),o&&o(g)},"edit"),onpaste:a(g=>{let R=g.clipboardData.getData("Text");if(R.length>0){g.preventDefault(),g.stopPropagation();let u=R.split(`
`).map(k=>k.trim()).filter(k=>k.length>0);p.buffer=u.shift(),s(p.buffer,!0);let I=c.node;for(let k of u){let y=h.workspace.new(k);y.parent=I.parent,y.siblingIndex=I.siblingIndex+1,m.redraw.sync();let E=c.clone();E.pop(),h.focus(E.append(y)),I=y}}},"handlePaste"),placeholder:d,onkeydown:e||a(g=>{g.key==="Enter"&&(g.preventDefault(),g.stopPropagation())},"defaultKeydown"),value:x},x),m("span",{style:{visibility:"hidden",position:"fixed"}}))}};var De={view({attrs:{workbench:i,path:e}}){return m("div",{class:"empty-view"})}};var le={view({attrs:{workbench:i,path:e}}){return m("div",{class:"new-node flex flex-row items-center"},m("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 16 16"},m("circle",{cx:"8",cy:"7",r:"7"}),m("path",{style:{transform:"translate(0px, -1px)"},d:"M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"})),m("div",{class:"flex grow"},m("input",{class:"grow",type:"text",onkeydown:a(n=>{if(n.key==="Tab"){if(n.stopPropagation(),n.preventDefault(),node.childCount>0){let o=e.node.children[e.node.childCount-1];i.executeCommand("insert-child",{node:o,path:e})}}else i.executeCommand("insert-child",{node:e.node,path:e},n.target.value)},"keydown"),value:""})))}};function Qe(i,e=1e3){let t;return(...n)=>{clearTimeout(t),t=setTimeout(()=>{i.apply(this,n)},e)}}a(Qe,"debounce");var $=class{constructor(){this.workbench=window.workbench,this.searchDebounce=Qe(this.search.bind(this)),this.query="",this.initialSearch=!1}handleIcon(e=!1){return m("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",class:"node-bullet",width:"15",height:"15",fill:"none",stroke:"currentColor","stroke-width":"3","stroke-linecap":"round","stroke-linejoin":"round"},e?m("circle",{id:"node-collapsed-handle",stroke:"none",cx:"12",cy:"12",r:"12"}):null,m("svg",{xmlns:"http://www.w3.org/2000/svg",x:"3",y:"3",width:"19",height:"19",viewBox:"0 0 24 24"},m("circle",{cx:"11",cy:"11",r:"8"}),m("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})))}belowEditor(){return Ke}onAttach(e){this.component=e,this.object=e.parent,e.bus.observe(t=>{e.isDestroyed||this.searchDebounce()})}search(){if(!this.object)return;if(!this.query){this.lastQuery="",this.results=[];return}this.initialSearch=!0;let e=this.workbench.search(this.query).filter(t=>t.id!==this.object.id&&t.id!==this.component.id);(e.length!==this.lastResultCount||this.query!==this.lastQuery)&&(this.results&&this.results.forEach(t=>t.destroy()),this.results=e.map(t=>{let n=this.object.bus.make("");return n.raw.Parent="@tmp",n.refTo=t,n}),this.lastQuery=this.query,this.lastResultCount=e.length)}objectChildren(e,t){return!this.results&&this.query&&!this.initialSearch&&this.search(),this.results||[]}toJSON(e){return{query:this.query}}fromJSON(e){this.query=e.query||""}static initialize(e){e.commands.registerCommand({id:"make-smart-node",title:"Make Smart Node",when:t=>!(!t.node||t.node.raw.Rel==="Fields"||t.node.childCount>0||t.node.parent&&t.node.parent.hasComponent(Document)),action:t=>{e.defocus();let n=new $;t.node.addComponent(n),e.workspace.setExpanded(t.path.head,t.node,!0),t.node.name===""&&setTimeout(()=>{t.node.name="Unnamed Smart Node",m.redraw(),document.querySelector(`#node-${t.path.id}-${t.node.id} input`).focus()},10)}})}};a($,"SmartNode"),$=N([S],$);var Ke={view({attrs:{node:i,component:e,expanded:t}}){if(!t)return;let n=a(o=>{e.query=o.target.value,e.search(),i.changed()},"oninput");return m("div",{class:"expanded-node flex flex-row"},m("div",{class:"indent flex"}),m("input",{type:"text",class:"grow",placeholder:"Enter search",value:e.query,oninput:n,style:{background:"inherit",border:"1px solid var(--color-outline-secondary)",outline:"0",padding:"var(--1)",marginBottom:"var(--1)",borderRadius:"var(--border-radius)"}}))}};var Ie={view({attrs:{workbench:i,path:e,alwaysShowNew:t}}){let n=e.node;e.node.refTo&&(n=e.node.refTo);let o=!1;return(n.childCount===0&&n.getLinked("Fields").length===0||t)&&(o=!0),n.hasComponent($)&&(o=!1),m("div",{class:"list-view"},m("div",{class:"fields"},n.getLinked("Fields").length>0&&n.getLinked("Fields").map(r=>m(V,{key:r.id,workbench:i,path:e.append(r)}))),m("div",{class:"children"},n.childCount>0&&n.children.map(r=>m(V,{key:r.id,workbench:i,path:e.append(r)})),o&&m(le,{workbench:i,path:e})))}};var Ee={view({attrs:{workbench:i,path:e},state:t}){let n=e.node;t.fields=t.fields===void 0?new Set:t.fields,n.children.forEach(r=>{r.getLinked("Fields").forEach(s=>t.fields.add(s.name))});let o=a((r,s)=>{let l=r.getLinked("Fields").filter(d=>d.name===s);return l.length===0?"":m(U,{editValue:!0,workbench:i,path:e.append(l[0])})},"getFieldEditor");return m("table",{class:"table-view",style:{gridTemplateColumns:`repeat(${t.fields.size+1}, 1fr)`}},m("thead",null,m("tr",null,m("th",null,"Title"),[...t.fields].map(r=>m("th",null,r)))),m("tbody",null,n.children.map(r=>m("tr",null,m("td",null,m(V,{key:r.id,workbench:i,path:e.append(r)})),[...t.fields].map(s=>m("td",null,o(r,s)))))))}};var Le={view({attrs:{workbench:i,path:e},state:t}){let n=e.node;t.tabs=t.tabs===void 0?new Set:t.tabs,t.selectedTab=t.selectedTab===void 0?"":t.selectedTab,n.children.forEach(s=>{t.tabs.add(s.raw),t.selectedTab===""&&(t.selectedTab=s.raw.ID)});let o=a(s=>{t.selectedTab=s},"handleTabClick"),r=n.children.find(s=>s.id===t.selectedTab);return m("div",{class:"tabs-view"},m("div",{class:"tabs"},[...t.tabs].map(s=>m("div",{class:s.ID===t.selectedTab?"active":"",onclick:()=>o(s.ID)},s.Name)),m("div",{style:{flexGrow:1}})),m("div",{class:"tab-content"},m(ae(r),{workbench:i,path:e.append(r)})))}};var Ae={view({attrs:{workbench:i,path:e,alwaysShowNew:t}}){let n=e.node;e.node.refTo&&(n=e.node.refTo);let o=!1;return(n.childCount===0&&n.getLinked("Fields").length===0||t)&&(o=!0),m("div",{class:"document-view"},m("div",{class:"fields"},n.getLinked("Fields").length>0&&n.getLinked("Fields").map(r=>m(V,{key:r.id,workbench:i,path:e.append(r)}))),m("div",{class:"children"},n.childCount>0&&n.children.map(r=>m(V,{key:r.id,workbench:i,path:e.append(r)})),o&&m(le,{workbench:i,path:e})))}};var Pe={list:Ie,table:Ee,tabs:Le,document:Ae};function ae(i){return Pe[i.getAttr("view")||"list"]||De}a(ae,"getNodeView");window.registerView=(i,e)=>{Pe[i]=e,workbench.commands.registerCommand({id:`view-${i}`,title:`View as ${Ye(i)}`,action:t=>{t.node&&t.node.setAttr("view",i)}})};function Ye(i){return i.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})}a(Ye,"toTitleCase");var M=class{constructor(){}onAttach(e){this.object=e.parent}handleIcon(e=!1){return m("svg",{xmlns:"http://www.w3.org/2000/svg",width:"15",height:"15",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"3","stroke-linecap":"round","stroke-linejoin":"round",class:"node-bullet"},e?m("circle",{id:"node-collapsed-handle",stroke:"none",cx:"12",cy:"12",r:"12"}):null,m("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"}),m("path",{d:"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"}))}toJSON(e){return{}}static initialize(e){e.commands.registerCommand({id:"make-template",title:"Make Template",when:t=>!(!t.node||t.node.raw.Rel==="Fields"||t.node.parent&&t.node.parent.hasComponent(Document)),action:t=>{let n=new M;t.node.addComponent(n),t.node.changed()}})}static findNode(e,t){let n=null;return e.mainNode().walk(o=>o.value instanceof M&&o.value.object.name===t?(n=o.value.object,!0):!1,{includeComponents:!0}),n}};a(M,"Template"),M=N([S],M);var T=class{constructor(e){this.name=e}afterEditor(){return Ge}static initialize(e){e.commands.registerCommand({id:"add-tag",title:"Add tag",hidden:!0,action:(t,n)=>{if(!t.node)return;let o=new T(n);t.node.addComponent(o);let r=M.findNode(e.workspace,n);r&&(r.fields.map(s=>s.duplicate()).forEach(s=>{t.node.addLinked("Fields",s),s.raw.Parent=t.node.raw.ID}),r.children.map(s=>s.duplicate()).forEach(s=>{t.node.addChild(s),s.raw.Parent=t.node.raw.ID})),t.node.changed()}})}static findAll(e){let t=new Set;return e.mainNode().walk(n=>(n.value instanceof T&&t.add(n.value.name),!1),{includeComponents:!0}),[...t]}static findTagged(e,t){let n=[];return e.mainNode().walk(o=>(o.value instanceof T&&o.value.name===t&&n.push(o.parent),!1),{includeComponents:!0}),n}static showPopover(e,t,n,o,r){let s=T.findAll(e.workspace),l=e.getInput(t),d=l.getBoundingClientRect(),c=document.body.scrollLeft+d.x+l.selectionStart*10+20,h=document.body.scrollTop+d.y+d.height;e.showPopover(()=>m(G,{onpick:p=>{r(),e.getInput(t).blur(),n.name=n.name.replace(/\s*#\w*/,""),e.executeCommand("add-tag",{node:n,path:t},p.name)},onchange:p=>{n.name.includes("#")?p.input=n.name.split("#")[1]:p.input="";let x=[...s].filter(A=>A.toLowerCase().startsWith(p.input.toLowerCase())).map(A=>({name:A}));(x[0]&&x[0].name!=p.input&&p.input!=""||x.length===0)&&x.unshift({name:p.input,prefix:"Create tag: "}),p.items=x},inputview:o,itemview:p=>m("div",{class:"flex"},m("div",null,p.prefix||"",p.name))}),{top:`${h}px`,left:`${c}px`})}};a(T,"Tag"),T=N([S],T);var Ge={view({attrs:{node:i,component:e}}){return m("div",{tabindex:"1",class:"badge flex flex-row items-center",onkeydown:a(n=>{n.key==="Backspace"&&(i.removeComponent(e),i.changed())},"onkeydown")},m("span",null,"#\xA0"),m("div",{style:{whiteSpace:"nowrap"}},e.name))}};var ce={view({attrs:{workbench:i,path:e,alwaysShowNew:t}}){return H(e.node,"childrenView")?m(X(e.node,"childrenView")[0].childrenView(),{workbench:i,path:e}):m(ae(e.node),{workbench:i,path:e,alwaysShowNew:t})}},V={view({attrs:i,state:e,children:t}){let{path:n,workbench:o}=i,r=n.node,s=!1,l=r;r.refTo&&(s=!0,r=l.refTo);let d=!1;o.clipboard&&o.clipboard.op==="cut"&&o.clipboard.node.id===r.id&&(d=!0);let c=o.workspace.getExpanded(n.head,l),h=H(r,"handlePlaceholder")?se(r,"handlePlaceholder"):"",p=a(u=>{e.hover=!0,u.stopPropagation()},"hover"),x=a(u=>{e.hover=!1,u.stopPropagation()},"unhover"),A=a(()=>{e.tagPopover&&(o.closePopover(),e.tagPopover=void 0)},"cancelTagPopover"),v=a(u=>{e.tagPopover?(e.tagPopover.oninput(u),u.target.value.includes("#")||A()):u.target.value.includes("#")&&(e.tagPopover={},T.showPopover(o,n,r,(I,k)=>{e.tagPopover={onkeydown:I,oninput:k}},A))},"oninput"),w=a(u=>{if(e.tagPopover){if(u.key==="Escape"){A();return}if(e.tagPopover.onkeydown(u)===!1)return u.stopPropagation(),!1}let I=u.shiftKey||u.metaKey||u.altKey||u.ctrlKey;switch(u.key){case"ArrowUp":u.target.selectionStart!==0&&!I&&u.stopPropagation();break;case"ArrowDown":u.target.selectionStart!==u.target.value.length&&u.target.selectionStart!==0&&!I&&u.stopPropagation();break;case"Backspace":if(u.target.value===""){if(u.preventDefault(),u.stopPropagation(),r.childCount>0)return;o.executeCommand("delete",{node:r,path:n,event:u});return}if(u.target.value!==""&&u.target.selectionStart===0&&u.target.selectionEnd===0){if(u.preventDefault(),u.stopPropagation(),r.childCount>0)return;let k=o.workspace.findAbove(n);if(!k)return;let y=k.node.name;k.node.name=y+u.target.value,r.destroy(),m.redraw.sync(),o.focus(k,y.length);return}break;case"Enter":if(u.preventDefault(),u.ctrlKey||u.shiftKey||u.metaKey||u.altKey)return;if(u.target.selectionStart===u.target.value.length){r.childCount>0&&o.workspace.getExpanded(n.head,r)?o.executeCommand("insert-child",{node:r,path:n},"",0):o.executeCommand("insert",{node:r,path:n}),u.stopPropagation();return}if(u.target.selectionStart===0){o.executeCommand("insert-before",{node:r,path:n}),u.stopPropagation();return}if(u.target.selectionStart>0&&u.target.selectionStart<u.target.value.length){o.executeCommand("insert",{node:r,path:n},u.target.value.slice(u.target.selectionStart)).then(()=>{r.name=u.target.value.slice(0,u.target.selectionStart)}),u.stopPropagation();return}break}},"onkeydown"),f=a(u=>{u.preventDefault(),u.stopPropagation(),o.executeCommand("zoom",{node:r,path:n}),document.selection&&document.selection.empty?document.selection.empty():window.getSelection&&window.getSelection().removeAllRanges()},"open"),b=a(u=>{if(r.hasComponent(C)){f(u);return}c?o.executeCommand("collapse",{node:l,path:n}):o.executeCommand("expand",{node:l,path:n}),u.stopPropagation()},"toggle"),g=a(u=>u.childCount+u.getLinked("Fields").length,"subCount"),R=a(()=>{if(r.id===o.context?.node?.id||e.hover||r.name.length>0||h.length>0)return!0},"showHandle");return m("div",{onmouseover:p,onmouseout:x,id:`node-${n.id}-${l.id}`,class:d?"cut-node":""},m("div",{class:"node-row-outer-wrapper flex flex-row items-start"},m("svg",{class:"node-menu shrink-0",xmlns:"http://www.w3.org/2000/svg",onclick:u=>o.showMenu(u,{node:l,path:n}),oncontextmenu:u=>o.showMenu(u,{node:l,path:n}),"data-menu":"node",viewBox:"0 0 16 16"},e.hover&&m("path",{style:{transform:"translateY(-1px)"},fill:"currentColor","fill-rule":"evenodd",d:"M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5z"})),m("div",{class:"node-handle shrink-0",onclick:b,ondblclick:f,oncontextmenu:u=>o.showMenu(u,{node:l,path:n}),"data-menu":"node",style:{display:R()?"block":"none"}},H(r,"handleIcon")?se(r,"handleIcon",g(r)>0&&!c):m("svg",{class:"node-bullet",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg"},g(r)>0&&!c?m("circle",{id:"node-collapsed-handle",cx:"8",cy:"8",r:"8"}):null,m("circle",{cx:"8",cy:"8",r:"3",fill:"currentColor"}),",",s?m("circle",{id:"node-reference-handle",cx:"8",cy:"8",r:"7",fill:"none","stroke-width":"1",stroke:"currentColor","stroke-dasharray":"3,3"}):null)),r.raw.Rel==="Fields"?m("div",{class:"flex grow items-start flex-row"},m("div",null,m(U,{workbench:o,path:n,onkeydown:w,oninput:v})),m(U,{editValue:!0,workbench:o,path:n,onkeydown:w,oninput:v})):m("div",{class:"flex grow items-start flex-row",style:{gap:"0.5rem"}},H(r,"beforeEditor")&&X(r,"beforeEditor").map(u=>m(u.beforeEditor(),{node:r,component:u})),m(U,{workbench:o,path:n,onkeydown:w,oninput:v,placeholder:h}),H(r,"afterEditor")&&X(r,"afterEditor").map(u=>m(u.afterEditor(),{node:r,component:u})))),H(r,"belowEditor")&&X(r,"belowEditor").map(u=>m(u.belowEditor(),{node:r,component:u,expanded:c})),c===!0&&m("div",{class:"expanded-node flex flex-row"},m("div",{class:"indent flex",onclick:b}),m("div",{class:"view grow"},H(r,"childrenView")?m(X(r,"childrenView")[0].childrenView(),{workbench:o,path:n}):m(ae(r),{workbench:o,path:n}))))}};var Te={view({attrs:{workbench:i,node:e}}){let t=new O(e,"quickadd");return m("div",{class:"notice"},m("h3",null,"Quick Add"),m(ce,{workbench:i,path:t,alwaysShowNew:!0}),m("div",{class:"button-bar"},m("button",{class:"primary",onclick:()=>{i.commitQuickAdd(),i.closeDialog()}},"Add to Today")))}};var Fe={view({attrs:{workbench:i},state:e}){let t=i.workspace.settings.theme;return e.selectedTheme=e.selectedTheme===void 0?t:e.selectedTheme,m("div",{class:"notice"},m("h3",null,"Settings"),m("div",{class:"flex flex-row"},m("div",{class:"grow"},"Theme"),m("div",null,m("select",{name:"theme",oninput:a(o=>{e.selectedTheme=o.target.value},"oninput")},m("option",{selected:e.selectedTheme==="",value:""},"Light"),m("option",{selected:e.selectedTheme==="darkmode",value:"darkmode"},"Dark"),m("option",{selected:e.selectedTheme==="sepia",value:"sepia"},"Sepia"),m("option",{selected:e.selectedTheme==="sublime",value:"sublime"},"Sublime")))),m("div",{class:"button-bar"},m("button",{onclick:()=>{i.closeDialog()}},"Cancel"),m("button",{class:"primary",onclick:async o=>{t!==e.selectedTheme?(i.workspace.settings.theme=e.selectedTheme,await i.workspace.save(!0),location.reload()):i.closeDialog()}},"Save Changes")))}};var Re={view(){return m("div",{class:"notice"},m("h3",null,"Refresh to view latest updates"),m("p",null,"Your notes were updated in another browser session. Refresh the page to view the latest version."),m("div",{class:"button-bar"},m("button",{class:"primary",onclick:()=>{location.reload()}},"Refresh Now")))}},je={view({attrs:{workbench:i}}){return m("div",{class:"notice"},m("h3",null,"Treehouse is under active development"),m("p",null,"This is a preview based on our main branch, which is actively being developed."),m("p",null,"If you find a bug, please report it via \xA0",m("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 14",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-menu"},m("line",{x1:"3",y1:"12",x2:"21",y2:"12"}),m("line",{x1:"3",y1:"6",x2:"21",y2:"6"}),m("line",{x1:"3",y1:"18",x2:"21",y2:"18"})),"\xA0> ",m("strong",null,"Submit Issue"),"."),m("p",null,"Data is stored using localstorage, which you can reset via \xA0",m("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 14",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-menu"},m("line",{x1:"3",y1:"12",x2:"21",y2:"12"}),m("line",{x1:"3",y1:"6",x2:"21",y2:"6"}),m("line",{x1:"3",y1:"18",x2:"21",y2:"18"})),"\xA0> ",m("strong",null,"Reset Demo"),"."),m("div",{class:"button-bar"},m("button",{class:"primary",onclick:()=>{localStorage.setItem("firsttime","1"),i.closeDialog()}},"Got it")))}},Be={view({attrs:{workbench:i,finished:e}}){return m("div",{class:"notice"},m("h3",null,"Login with GitHub"),m("p",null,"The GitHub backend is experimental so use at your own risk!"),m("p",null,"To store your workbench we will create a public repository called ",m("pre",{style:{display:"inline"}},"<username>.treehouse.sh")," if it doesn't already exist. You can manually make this repository private via GitHub if you want."),m("p",null,"You can Logout via the \xA0",m("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 14",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-menu"},m("line",{x1:"3",y1:"12",x2:"21",y2:"12"}),m("line",{x1:"3",y1:"6",x2:"21",y2:"6"}),m("line",{x1:"3",y1:"18",x2:"21",y2:"18"})),"\xA0 menu in the top right to return to the localstorage backend."),m("div",{class:"button-bar"},m("button",{onclick:()=>{i.closeDialog()}},"Cancel"),m("button",{class:"primary",onclick:()=>{i.closeDialog(),localStorage.setItem("github","1"),e()}},"Log in with GitHub")))}};var _=class{constructor(e){this.commands=new re,this.keybindings=new oe,this.menus=new ie,this.backend=e,this.workspace=new ee(e.files),this.context={node:null},this.panels=[],this.drawer={open:!1},this.dialog={body:()=>null},this.menu={body:()=>null}}get mainPanel(){return this.panels[0]}async initialize(){if(await this.workspace.load(),this.workspace.rawNodes.forEach(e=>this.backend.index.index(e)),this.workspace.observe(e=>{this.workspace.save(),e.isDestroyed?this.backend.index.remove(e.id):(this.backend.index.index(e.raw),e.components.forEach(t=>this.backend.index.index(t.raw)))}),this.workspace.lastOpenedID?this.openNewPanel(this.workspace.find(this.workspace.lastOpenedID)||this.workspace.mainNode()):this.openNewPanel(this.workspace.mainNode()),this.backend.loadExtensions&&await this.backend.loadExtensions(),this.workspace.settings.theme){let e=document.createElement("link");e.setAttribute("href",`https://treehouse.sh/style/themes/${this.workspace.settings.theme}.css`),e.setAttribute("rel","stylesheet"),e.setAttribute("type","text/css"),document.head.appendChild(e)}m.redraw()}authenticated(){return this.backend.auth&&this.backend.auth.currentUser()}openQuickAdd(){let e=this.workspace.find("@quickadd");e||(e=this.workspace.new("@quickadd")),this.showDialog(()=>m(Te,{workbench:this,node:e}),!0),setTimeout(()=>{document.querySelector("main > dialog .new-node input").focus()},1)}commitQuickAdd(){let e=this.workspace.find("@quickadd");if(!e)return;let t=this.todayNode();e.children.forEach(n=>n.parent=t)}clearQuickAdd(){let e=this.workspace.find("@quickadd");e&&e.children.forEach(t=>t.destroy())}todayNode(){let e=new Date,t=e.toUTCString().split(e.getFullYear())[0],n=`Week ${String(Xe(e)).padStart(2,"0")}`,r=["@calendar",`${e.getFullYear()}`,n,t].join("/"),s=this.workspace.find(r);return s||(s=this.workspace.new(r)),s}openToday(){this.open(this.todayNode())}open(e){this.workspace.expanded[e.id]||(this.workspace.expanded[e.id]={}),this.workspace.lastOpenedID=e.id,this.workspace.save();let t=new O(e);this.panels[0]=t,this.context.path=t}openNewPanel(e){this.workspace.expanded[e.id]||(this.workspace.expanded[e.id]={}),this.workspace.lastOpenedID=e.id,this.workspace.save();let t=new O(e);this.panels.push(t),this.context.path=t}closePanel(e){this.panels=this.panels.filter(t=>t.name!==e.name)}defocus(){let e=this.getInput(this.context.path);e&&e.blur(),this.context.node=null,this.context.path=null}focus(e,t=0){let n=this.getInput(e);n?(this.context.path=e,n.focus(),t!==void 0&&n.setSelectionRange(t,t)):console.warn("unable to find input for",e)}getInput(e){let t=`input-${e.id}-${e.node.id}`;e.node.raw.Rel==="Fields"&&e.node.name!==""&&(t=t+"-value");let n=document.getElementById(t);return n.editor?n.editor:n}canExecuteCommand(e,t,...n){return t=this.newContext(t),this.commands.canExecuteCommand(e,t,...n)}executeCommand(e,t,...n){return t=this.newContext(t),console.log(e,t,...n),this.commands.executeCommand(e,t,...n)}newContext(e){return Object.assign({},this.context,e)}showMenu(e,t,n){e.stopPropagation(),e.preventDefault();let o=e.target.closest("*[data-menu]"),r=o.getBoundingClientRect();if(!n){let d=o.dataset.align||"left";n={top:`${document.body.scrollTop+r.y+r.height}px`},d==="right"?(n.marginLeft="auto",n.marginRight=`${document.body.offsetWidth-r.right}px`):(n.marginLeft=`${document.body.scrollLeft+r.x}px`,n.marginRight="auto")}let s=this.menus.menus[o.dataset.menu],l=s.filter(d=>d.command).map(d=>this.commands.commands[d.command]);s&&(this.menu={body:()=>m(xe,{workbench:this,ctx:this.newContext(t),items:s,commands:l}),style:n},m.redraw(),setTimeout(()=>{document.querySelector("main > dialog.menu").showModal()},0))}closeMenu(){document.querySelector("main > dialog.menu").close(),workbench.menu.body=()=>null}showPalette(e,t,n){this.showDialog(()=>m(Ce,{workbench:this,ctx:n}),!1,{left:`${e}px`,top:`${t}px`})}showNotice(e,t){this.showDialog(()=>m({firsttime:je,github:Be,lockstolen:Re}[e],{workbench:this,finished:t}),!0,void 0,e==="lockstolen")}toggleDrawer(){this.drawer.open=!this.drawer.open,m.redraw()}showSettings(){this.showDialog(()=>m(Fe,{workbench:this}),!0)}showPopover(e,t){this.popover={body:e,style:t},m.redraw()}closePopover(){this.popover=null,m.redraw()}showDialog(e,t,n,o){this.dialog={body:e,backdrop:t,style:n,explicitClose:o},m.redraw(),setTimeout(()=>{document.querySelector("main > dialog.modal").showModal()},0)}isDialogOpen(){return document.querySelector("main > dialog.modal").hasAttribute("open")}closeDialog(){document.querySelector("main > dialog.modal").close(),this.dialog.body=()=>null}search(e){if(!e)return[];let t=e.split(/\s+(?=(?:[^\'"]*[\'"][^\'"]*[\'"])*[^\'"]*$)/),n=t.filter(l=>!l.includes(":")).join(" "),o=Object.fromEntries(t.filter(l=>l.includes(":")).map(l=>l.toLowerCase().split(":")));!n&&Object.keys(o).length>0&&(n=Object.keys(o)[0]);let r=a(l=>{if(Object.keys(o).length>0){let d={};for(let c of l.getLinked("Fields"))d[c.name.toLowerCase()]=c.value.toLowerCase();for(let c in o){let h=d[c.replace(/['"]/g,"")];if(!h||h!==o[c].replace(/['"]/g,""))return!1}}return!0},"passFieldQuery");if(n.startsWith("#"))return T.findTagged(this.workspace,n.replace("#","")).filter(r);let s={};return this.backend.index.search(n).forEach(l=>{let d=window.workbench.workspace.find(l);d&&(d.value&&(d=d.parent,!d.raw)||r(d)&&(s[d.id]=d))}),Object.values(s)}};a(_,"Workbench");function Xe(i){var e=new Date(Date.UTC(i.getFullYear(),i.getMonth(),i.getDate())),t=e.getUTCDay()||7;e.setUTCDate(e.getUTCDate()+4-t);var n=new Date(Date.UTC(e.getUTCFullYear(),0,1));return Math.ceil(((e-n)/864e5+1)/7)}a(Xe,"getWeekOfYear");function Oe(i){function e(k,y){var E=k<<y|k>>>32-y;return E}a(e,"rotate_left");function t(k){var y="",E,j,we;for(E=0;E<=6;E+=2)j=k>>>E*4+4&15,we=k>>>E*4&15,y+=j.toString(16)+we.toString(16);return y}a(t,"lsb_hex");function n(k){var y="",E,j;for(E=7;E>=0;E--)j=k>>>E*4&15,y+=j.toString(16);return y}a(n,"cvt_hex");function o(k){k=k.replace(/\r\n/g,`
`);for(var y="",E=0;E<k.length;E++){var j=k.charCodeAt(E);j<128?y+=String.fromCharCode(j):j>127&&j<2048?(y+=String.fromCharCode(j>>6|192),y+=String.fromCharCode(j&63|128)):(y+=String.fromCharCode(j>>12|224),y+=String.fromCharCode(j>>6&63|128),y+=String.fromCharCode(j&63|128))}return y}a(o,"Utf8Encode");var r,s,l,d=new Array(80),c=1732584193,h=4023233417,p=2562383102,x=271733878,A=3285377520,v,w,f,b,g,I;i=o(i);var R=i.length,u=new Array;for(s=0;s<R-3;s+=4)l=i.charCodeAt(s)<<24|i.charCodeAt(s+1)<<16|i.charCodeAt(s+2)<<8|i.charCodeAt(s+3),u.push(l);switch(R%4){case 0:s=2147483648;break;case 1:s=i.charCodeAt(R-1)<<24|8388608;break;case 2:s=i.charCodeAt(R-2)<<24|i.charCodeAt(R-1)<<16|32768;break;case 3:s=i.charCodeAt(R-3)<<24|i.charCodeAt(R-2)<<16|i.charCodeAt(R-1)<<8|128;break}for(u.push(s);u.length%16!=14;)u.push(0);for(u.push(R>>>29),u.push(R<<3&4294967295),r=0;r<u.length;r+=16){for(s=0;s<16;s++)d[s]=u[r+s];for(s=16;s<=79;s++)d[s]=e(d[s-3]^d[s-8]^d[s-14]^d[s-16],1);for(v=c,w=h,f=p,b=x,g=A,s=0;s<=19;s++)I=e(v,5)+(w&f|~w&b)+g+d[s]+1518500249&4294967295,g=b,b=f,f=e(w,30),w=v,v=I;for(s=20;s<=39;s++)I=e(v,5)+(w^f^b)+g+d[s]+1859775393&4294967295,g=b,b=f,f=e(w,30),w=v,v=I;for(s=40;s<=59;s++)I=e(v,5)+(w&f|w&b|f&b)+g+d[s]+2400959708&4294967295,g=b,b=f,f=e(w,30),w=v,v=I;for(s=60;s<=79;s++)I=e(v,5)+(w^f^b)+g+d[s]+3395469782&4294967295,g=b,b=f,f=e(w,30),w=v,v=I;c=c+v&4294967295,h=h+w&4294967295,p=p+f&4294967295,x=x+b&4294967295,A=A+g&4294967295}var I=n(c)+n(h)+n(p)+n(x)+n(A);return I.toLowerCase()}a(Oe,"SHA1");var O=class{constructor(e,t){t?this.name=t:this.name=Math.random().toString(36).substring(2),e?this.nodes=[e]:this.nodes=[]}push(e){this.nodes.push(e)}pop(){return this.nodes.pop()||null}sub(){return new O(this.node,this.name)}clone(){let e=new O;return e.name=this.name,e.nodes=[...this.nodes],e}append(e){let t=this.clone();return t.push(e),t}get length(){return this.nodes.length}get id(){return Oe([this.name,...this.nodes.map(e=>e.id)].join(":"))}get node(){return this.nodes[this.nodes.length-1]}get previous(){return this.nodes.length<2?null:this.nodes[this.nodes.length-2]}get head(){return this.nodes[0]}};a(O,"Path");var te=class{constructor(){this.nodes={"@root":{ID:"@root",Name:"@root",Linked:{Children:[],Components:[]},Attrs:{}}},this.observers=[]}changed(e){this.observers.forEach(t=>t(e))}import(e){for(let t of e)t.Value&&Z(t.Name)&&(t.Value=Ne(t.Name,t.Value),t.Rel="Components"),this.nodes[t.ID]=t;for(let t of e){if(t.Parent==="@tmp"){delete this.nodes[t.ID];continue}if(!t.ID.startsWith("@")&&t.Parent===void 0){delete this.nodes[t.ID];continue}if(t.Parent&&!this.nodes[t.Parent]){delete this.nodes[t.ID];continue}let n=this.find(t.ID);if(n){if(n.parent&&!n.parent.raw){delete this.nodes[t.ID];continue}Q(n,"onAttach",n)}}}export(){let e=[];for(let t of Object.values(this.nodes))e.push(t);return e}make(e,t){let n=null;if(e.includes("/")){let s=e.split("/");n=this.find(s[0]);for(let l=1;l<s.length-1;l++){if(n===null)throw"unable to get root";let d=n.find(s[l]);d||(d=this.make(s.slice(0,l+1).join("/"))),n=d}e=s[s.length-1]}let o=e.startsWith("@")?e:Ze();this.nodes[o]={ID:o,Name:e,Value:t,Linked:{Children:[],Components:[]},Attrs:{}};let r=new F(this,o);return n&&(r.parent=n),r}destroy(e){let t=e.parent;if(t!==null&&!t.isDestroyed){let n=e.raw.Rel||"Children";t.raw.Linked[n].includes(e.id)&&t.raw.Linked[n].splice(e.siblingIndex,1)}delete this.nodes[e.id],t&&this.changed(t)}roots(){return Object.values(this.nodes).filter(e=>e.Parent===void 0).map(e=>new F(this,e.ID))}root(e){e=e||"@root";let t=this.roots().find(n=>n.name===e);return t===void 0?null:t}find(e){let t=this.nodes[e];if(t)return new F(this,t.ID);let n=e.split("/");if(n.length===1&&n[0].startsWith("@"))return null;let o=this.root(n[0]);if(!o&&this.nodes[n[0]]&&(o=new F(this,this.nodes[n[0]].ID)),o?n.shift():o=this.root("@root"),!o)return null;let r=a((s,l)=>(s.refTo&&(s=s.refTo),s.children.find(d=>d.name===l)),"findChild");for(let s of n){let l=r(o,s);if(!l)return null;o=l}return o}walk(e,t){for(let n of this.roots())if(n.walk(e,t))return}observe(e){this.observers.push(e)}};a(te,"Bus");var Ze=a(()=>{let i=Date.now().toString(36),e=Math.random().toString(36).substring(2);return i+e},"uniqueId");var F=class{constructor(e,t){this._bus=e,this._id=t}[Symbol.for("Deno.customInspect")](){return`Node[${this.id}:${this.name}]`}get id(){return this._id}get bus(){return this._bus}get raw(){let e=this._bus.nodes[this.id];if(!e)throw`use of non-existent node ${this.id}`;return e}get name(){return this.refTo?this.refTo.name:this.raw.Name}set name(e){this.refTo?this.refTo.name=e:this.raw.Name=e,this.changed()}get value(){return this.refTo?this.refTo.value:this.raw.Value}set value(e){this.refTo?this.refTo.value=e:this.raw.Value=e,this.changed()}get parent(){return!this.raw.Parent||!this._bus.nodes[this.raw.Parent]?null:new F(this._bus,this.raw.Parent)}set parent(e){let t=this.parent;t!==null&&t.raw.Linked.Children.splice(this.siblingIndex,1),e!==null?(this.raw.Parent=e.id,e.raw.Linked.Children.push(this.id),Q(e,"onAttach",e)):this.raw.Parent=void 0,this.changed()}get refTo(){let e=this.raw.Attrs.refTo;return!e||!this._bus.nodes[e]?null:new F(this._bus,e)}set refTo(e){if(!e){delete this.raw.Attrs.refTo,this.changed();return}this.raw.Attrs.refTo=e.id,this.changed()}get siblingIndex(){let e=this.parent;if(e===null)return 0;let t=this.raw.Rel||"Children";return e.raw.Linked[t].findIndex(n=>n===this.id)}set siblingIndex(e){let t=this.parent;if(t===null)return;let n=this.raw.Rel||"Children";t.raw.Linked[n].splice(this.siblingIndex,1),t.raw.Linked[n].splice(e,0,this.id),t.changed()}get prevSibling(){let e=this.parent;if(e===null||this.siblingIndex===0)return null;let t=this.raw.Rel||"Children";return e.getLinked(t)[this.siblingIndex-1]}get nextSibling(){let e=this.parent;if(e===null||this.siblingIndex===e.children.length-1)return null;let t=this.raw.Rel||"Children";return e.getLinked(t)[this.siblingIndex+1]}get ancestors(){let e=[],t=this.parent;for(;t!==null;)e.push(t),t=t.parent;return e}get isDestroyed(){return!this._bus.nodes.hasOwnProperty(this.id)}get path(){let e=this,t=[];for(;e;)t.unshift(e.name),e=e.parent;return t.join("/")}get children(){if(this.refTo)return this.refTo.children;let e=[];this.raw.Linked.Children&&(e=this.raw.Linked.Children.map(t=>new F(this._bus,t)));for(let t of this.components)if(J(t,"objectChildren"))return Q(t,"objectChildren",this,e);return e}get childCount(){if(this.refTo)return this.refTo.childCount;for(let e of this.components)if(J(e,"objectChildren"))return Q(e,"objectChildren",this,null).length;return this.raw.Linked.Children?this.raw.Linked.Children.length:0}addChild(e){if(this.refTo){this.refTo.addChild(e);return}this.raw.Linked.Children.push(e.id),this.changed()}removeChild(e){if(this.refTo){this.refTo.removeChild(e);return}let t=this.raw.Linked.Children.filter(n=>n===e.id);this.raw.Linked.Children=t,this.changed()}get fields(){return this.raw.Linked.Fields?this.raw.Linked.Fields.map(e=>new F(this._bus,e)):[]}get fieldCount(){return this.raw.Linked.Fields?this.raw.Linked.Fields.length:0}get components(){return this.raw.Linked.Components?this.raw.Linked.Components.map(e=>new F(this._bus,e)):[]}get componentCount(){return this.raw.Linked.Components?this.raw.Linked.Components.length:0}addComponent(e){let t=this.bus.make(K(e),e);t.raw.Parent=this.id,t.raw.Rel="Components",this.raw.Linked.Components.push(t.id),Q(t,"onAttach",t),this.changed()}removeComponent(e){let t;e.name&&Z(e)?t=this.components.filter(n=>n.name===K(e)):t=this.components.filter(n=>n.value===e),t.length>0&&t[0].destroy(),this.changed()}hasComponent(e){return this.components.filter(n=>n.name===K(e)).length>0}getComponent(e){let t=this.components.filter(n=>n.name===K(e));return t.length>0?t[0].value:null}getLinked(e){return this.raw.Linked[e]?this.raw.Linked[e].map(t=>new F(this._bus,t)):[]}addLinked(e,t){this.raw.Linked[e]||(this.raw.Linked[e]=[]),t.raw.Rel=e,this.raw.Linked[e].push(t.id),this.changed()}removeLinked(e,t){this.raw.Linked[e]||(this.raw.Linked[e]=[]);let n=this.raw.Linked[e].filter(o=>o===t.id);this.raw.Linked[e]=n,this.changed()}moveLinked(e,t,n){this.raw.Linked[e]||(this.raw.Linked[e]=[]);let o=this.raw.Linked[e].findIndex(s=>s===t.id);if(o===-1)return;let r=this.raw.Linked[e];r.splice(n,0,r.splice(o,1)[0]),this.raw.Linked[e]=r,this.changed()}getAttr(e){return this.raw.Attrs[e]||""}setAttr(e,t){this.raw.Attrs[e]=t,this.changed()}find(e){return this.bus.find([this.path,e].join("/"))}walk(e,t){if(t=t||{followRefs:!1,includeComponents:!1},e(this))return!0;let n=this.children;if(this.refTo&&t.followRefs){if(e(this.refTo))return!0;n=this.refTo.children}for(let o of n)if(o.walk(e,t))return!0;if(t.includeComponents){for(let o of this.components)if(o.walk(e,t))return!0}return!1}destroy(){if(this.isDestroyed)return;if(this.refTo){this._bus.destroy(this);return}let e=[];this.walk(t=>(e.push(t),!1),{followRefs:!1,includeComponents:!0}),e.reverse().forEach(t=>this._bus.destroy(t))}duplicate(){let e=this._bus.make(this.name,Se(this.value));return e.raw.Rel=this.raw.Rel,this.fields.map(t=>t.duplicate()).forEach(t=>{e.addLinked("Fields",t),t.raw.Parent=e.raw.ID}),this.components.map(t=>t.duplicate()).forEach(t=>{e.addLinked("Components",t),t.raw.Parent=e.raw.ID}),this.children.map(t=>t.duplicate()).forEach(t=>{e.addChild(t),t.raw.Parent=e.raw.ID}),e}changed(){this._bus.changed(this)}};a(F,"Node");var ee=class{constructor(e){this.fs=e,this.bus=new te,this.expanded={},this.settings={},this.writeDebounce=et(async(t,n)=>{try{await this.fs.writeFile(t,n),console.log("Saved workspace.")}catch(o){console.error(o),document.dispatchEvent(new CustomEvent("BackendError"))}})}get rawNodes(){return this.bus.export()}observe(e){this.bus.observe(e)}async save(e){let t=JSON.stringify({version:1,lastopen:this.lastOpenedID,expanded:this.expanded,nodes:this.rawNodes,settings:this.settings},null,2);e?await this.fs.writeFile("workspace.json",t):this.writeDebounce("workspace.json",t)}async load(){let e=JSON.parse(await this.fs.readFile("workspace.json")||"{}");if(e.nodes&&(e.nodes=e.nodes.map(t=>(t.Name==="treehouse.SearchNode"&&(t.Name="treehouse.SmartNode"),t)),this.bus.import(e.nodes),console.log(`Loaded ${e.nodes.length} nodes.`)),e.expanded)for(let t in e.expanded)for(let n in e.expanded[t])this.bus.find(n)&&(this.expanded[t]||(this.expanded[t]={}),this.expanded[t][n]=e.expanded[t][n]);e.lastopen&&(this.lastOpenedID=e.lastopen),e.settings&&(this.settings=Object.assign(this.settings,e.settings))}mainNode(){let e=this.bus.find("@workspace");if(!e){console.info("Building missing workspace node.");let t=this.bus.find("@root"),n=this.bus.make("@workspace");n.name="Workspace",n.parent=t;let o=this.bus.make("@calendar");o.name="Calendar",o.parent=n;let r=this.bus.make("Home");r.parent=n,e=n}return e}find(e){return this.bus.find(e)}new(e,t){return this.bus.make(e,t)}getExpanded(e,t){this.expanded[e.id]||(this.expanded[e.id]={});let n=this.expanded[e.id][t.id];return n===void 0&&(n=!1),n}setExpanded(e,t,n){this.expanded[e.id]||(this.expanded[e.id]={}),this.expanded[e.id][t.id]=n,this.save()}findAbove(e){if(e.node.id===e.head.id)return null;let t=e.clone();t.pop();let n=e.node.prevSibling;if(!n){let r=e.previous.getLinked("Fields").length;return e.node.raw.Rel!=="Fields"&&r>0?t.append(e.previous.getLinked("Fields")[r-1]):t}let o=a(r=>{if(!this.getExpanded(e.head,r.node))return r;let l=r.node.getLinked("Fields").length;if(r.node.childCount===0&&l>0){let c=r.node.getLinked("Fields")[l-1];return o(r.append(c))}if(r.node.childCount===0)return r;let d=r.node.children[r.node.childCount-1];return o(r.append(d))},"lastSubIfExpanded");return o(t.append(n))}findBelow(e){let t=e.clone();if(this.getExpanded(e.head,e.node)&&e.node.getLinked("Fields").length>0)return t.append(e.node.getLinked("Fields")[0]);if(this.getExpanded(e.head,e.node)&&e.node.childCount>0)return t.append(e.node.children[0]);let n=a(o=>{let r=o.node.nextSibling;if(r)return o.pop(),o.append(r);let s=o.previous;return s?o.node.raw.Rel==="Fields"&&s.childCount>0?(o.pop(),o.append(s.children[0])):(o.pop(),n(o)):null},"nextSiblingOrParentNextSibling");return n(t)}};a(ee,"Workspace");function et(i,e=3e3){let t;return(...n)=>{clearTimeout(t),t=setTimeout(()=>{i.apply(this,n)},e)}}a(et,"debounce");var Me={view({attrs:i,children:e}){let t=i.open;return m("div",{class:`drawer ${t?"open":"closed"}`},e)}};var He={view({attrs:i}){let e=i.path,t=i.workbench,n=e.node,o=a(c=>{t.executeCommand("close-panel",{},e)},"close"),r=a(c=>{e.pop()===e.node&&e.pop()},"goBack"),s=a(c=>{t.panels=[e],t.context.path=e},"maximize");function l(c=""){return 20+(c.match(/\n/g)||[]).length*20}a(l,"calcHeight");let d="";return n.getAttr("view")&&(d=`${n.getAttr("view")}-panel`),m("div",{class:`panel flex flex-col grow ${d}`},m("div",{class:"bar flex"},e.length>1?m("div",{class:"panel-back",style:{rightPadding:"var(--padding)"}},m("svg",{onclick:r,xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"},m("path",{"fill-rule":"evenodd",d:"M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8z"}))):null,m("div",{class:"panel-back-parent grow"},n.parent&&n.parent.id!=="@root"?m("span",{style:{cursor:"pointer"},onclick:()=>t.open(n.parent)},n.parent.name):m("span",null,"\xA0")),t.panels.length>1?m("div",{class:"panel-icons flex items-center"},m("svg",{onclick:s,style:{cursor:"pointer"},xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-maximize-2"},m("polyline",{points:"15 3 21 3 21 9"}),m("polyline",{points:"9 21 3 21 3 15"}),m("line",{x1:"21",y1:"3",x2:"14",y2:"10"}),m("line",{x1:"3",y1:"21",x2:"10",y2:"14"})),m("svg",{onclick:o,style:{cursor:"pointer"},xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-x"},m("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),m("line",{x1:"6",y1:"6",x2:"18",y2:"18"}))):null),m("div",{class:"body flex flex-col"},m("div",{class:"title-node",oncontextmenu:c=>t.showMenu(c,{node:n,path:e}),"data-menu":"node"},m(U,{workbench:t,path:e,disallowEmpty:!0})),m(ce,{workbench:t,path:e.sub(),alwaysShowNew:!0})))}};var $e={view({attrs:i}){let e=i.workbench,t={"":["pick-command"],Edit:["cut","copy","copy-reference","paste","mark-done","insert","delete"],Navigate:["expand","collapse","indent","outdent","move-up","move-down","prev","next"]},n=a(o=>{let r=e.keybindings.getBinding(o.id);return r?Y(r.key).join(" ").toUpperCase():""},"getBindingSymbols");return m("div",{class:"reference"},m("h2",null,"Keyboard Shortcuts"),Object.entries(t).map(([o,r])=>m("div",null,o.length!==0&&m("h3",null,o),m("div",null,r.map(s=>e.commands.commands[s]).map(s=>m("div",{class:"flex item"},m("div",{class:"keybindings text-left"},n(s)),m("div",{class:"grow"},s.title)))))))}};var ge={view({attrs:{input:i,workbench:e}}){return m("div",{class:"search"},m(G,{onpick:a(o=>{e.closeDialog(),e.open(o)},"onpick"),onchange:a(o=>{o.input?o.items=e.search(o.input):o.items=[]},"onchange"),input:i,inputview:(o,r,s)=>m("div",{class:"flex items-center"},m("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-search shrink-0 items-center"},m("circle",{cx:"11",cy:"11",r:"8"}),m("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})),m("input",{type:"text",placeholder:"Search",value:s,onkeydown:o,oninput:r})),itemview:o=>m("div",null,o.name)}))}};var We={view({attrs:{workbench:i},state:e}){e.open=e.open===void 0?!0:e.open;let t=a(n=>{e.open?e.open=!1:e.open=!0},"toggle");return m("main",{class:"workbench m-0 flex flex-row absolute inset-0",style:{overflow:"none"}},m("div",{class:"sidebar flex flex-col",style:{width:e.open?"256px":"52px"}},m("div",{class:"sidebar-top",style:{height:"56px"}},m("div",{class:"logo"})),m("div",{class:"grow sidebar-main"},e.open&&i.workspace.bus.root().children.map(n=>m(qe,{node:n,expanded:!0,level:0,workbench:i}))),m("div",{class:"sidebar-bottom"},m("svg",{onclick:t,xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-sidebar"},m("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),m("line",{x1:"9",y1:"3",x2:"9",y2:"21"})))),m("div",{class:"main flex flex-col grow"},m("div",{class:"topbar flex"},m("div",{class:"topbar-item",onclick:()=>i.openToday(),style:{cursor:"pointer",marginLeft:"var(--padding)",marginRight:"var(--padding)",display:"flex",alignItems:"center"}},m("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-calendar"},m("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),m("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),m("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),m("line",{x1:"3",y1:"10",x2:"21",y2:"10"})),m("div",null,"Today")),m("div",{class:"topbar-item",onclick:()=>i.openQuickAdd(),style:{cursor:"pointer",marginLeft:"var(--padding)",marginRight:"var(--padding)",display:"flex",alignItems:"center"}},m("svg",{style:{marginRight:"var(--1)"},xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-plus-circle"},m("circle",{cx:"12",cy:"12",r:"10"}),m("line",{x1:"12",y1:"8",x2:"12",y2:"16"}),m("line",{x1:"8",y1:"12",x2:"16",y2:"12"})),m("div",null,"Quick Add")),m("div",{class:"searchbar flex grow"},m("div",null,m("div",{class:"flex",style:{margin:"1px"}},m("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-search shrink-0"},m("circle",{cx:"11",cy:"11",r:"8"}),m("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})),m("input",{type:"text",placeholder:"Search",onkeydown:n=>{if(n.key==="Control"||n.key==="Alt"||n.key==="Shift"||n.key==="Meta")return;let o=n.target.getBoundingClientRect();i.showDialog(()=>m(ge,{workbench:i,input:n.key}),!1,{left:`${o.left-33}px`,top:`${o.top-9}px`,width:`${o.width+33}px`}),n.preventDefault()},style:{border:"0",outline:"0",background:"transparent",paddingTop:"3px"}})))),m("div",{onclick:()=>i.toggleDrawer(),"data-menu":"keyboard-reference","data-align":"right",style:{cursor:"pointer",marginLeft:"var(--padding)",marginRight:"var(--padding)",marginTop:"-2px"}},m("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},m("g",{"clip-path":"url(#clip0_442_8012)"},m("path",{d:"M20 6H4C2.89543 6 2 6.76751 2 7.71429V16.2857C2 17.2325 2.89543 18 4 18H20C21.1046 18 22 17.2325 22 16.2857V7.71429C22 6.76751 21.1046 6 20 6Z",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"}),m("path",{d:"M6 10H6.01",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"}),m("path",{d:"M7.5 12H7.51",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"}),m("path",{d:"M10.5 12H10.51",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"}),m("path",{d:"M13.5 12H13.51",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"}),m("path",{d:"M16.5 12H16.51",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"}),m("path",{d:"M9 10H9.01",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"}),m("path",{d:"M12 10H12.01",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"}),m("path",{d:"M15 10H15.01",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"}),m("path",{d:"M18 10H18.01",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"}),m("path",{d:"M5 15H19",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"})),m("defs",null,m("clipPath",{id:"clip0_442_8012"},m("rect",{width:"22",height:"14",fill:"white",transform:"translate(1 5)"}))))),m("div",{onclick:n=>i.showMenu(n),"data-menu":"settings","data-align":"right",style:{cursor:"pointer",marginLeft:"var(--padding)",marginRight:"var(--padding)"}},m("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-menu"},m("line",{x1:"3",y1:"12",x2:"21",y2:"12"}),m("line",{x1:"3",y1:"6",x2:"21",y2:"6"}),m("line",{x1:"3",y1:"18",x2:"21",y2:"18"})))),m("div",{class:"panels flex flex-row grow",style:{position:"relative",overflow:"hidden"}},i.panels.map(n=>m("div",null,m(He,{workbench:i,path:n}))),m(Me,{open:i.drawer.open},m($e,{workbench:i}))),m("div",{class:"mobile-nav flex-row"},m("div",null,m("svg",{onclick:()=>{let n=document.querySelector(".sidebar").style;n.display!=="flex"?n.display="flex":n.display="none"},xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-sidebar"},m("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),m("line",{x1:"9",y1:"3",x2:"9",y2:"21"}))),m("div",{onclick:()=>i.openToday()},m("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-calendar"},m("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),m("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),m("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),m("line",{x1:"3",y1:"10",x2:"21",y2:"10"}))),m("div",{onclick:()=>i.openQuickAdd()},m("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-plus-circle"},m("circle",{cx:"12",cy:"12",r:"10"}),m("line",{x1:"12",y1:"8",x2:"12",y2:"16"}),m("line",{x1:"8",y1:"12",x2:"16",y2:"12"}))),m("div",{onclick:()=>i.showDialog(()=>m(ge,{workbench:i}),!0,{top:"25%",bottom:"100px"})},m("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-search shrink-0"},m("circle",{cx:"11",cy:"11",r:"8"}),m("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"}))),m("div",{onclick:n=>i.showMenu(n,void 0,{bottom:"100px",marginTop:"auto"}),"data-menu":"settings"},m("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-menu"},m("line",{x1:"3",y1:"12",x2:"21",y2:"12"}),m("line",{x1:"3",y1:"6",x2:"21",y2:"6"}),m("line",{x1:"3",y1:"18",x2:"21",y2:"18"}))))),i.popover&&m("div",{class:"popover",style:{position:"absolute",...i.popover.style}},i.popover.body()),m("dialog",{class:i.dialog.backdrop?"popover modal backdrop":"popover modal",style:i.dialog.style?{margin:"0",...i.dialog.style}:{top:"-50%"},oncancel:n=>{if(i.dialog.explicitClose===!0){n.preventDefault();return}i.dialog.body=()=>null},onclick:n=>{let r=n.target.closest("dialog").getBoundingClientRect(),s=n.clientX==0&&n.clientY==0;i.dialog.explicitClose!==!0&&(n.clientX<r.left||n.clientX>r.right||n.clientY<r.top||n.clientY>r.bottom)&&!s&&i.closeDialog()}},i.dialog.body()),m("dialog",{class:"menu popover",style:{margin:"0",...i.menu.style},oncancel:n=>{i.menu.body=()=>null},onclick:n=>{let r=n.target.closest("dialog").getBoundingClientRect();(n.clientX<r.left||n.clientX>r.right||n.clientY<r.top||n.clientY>r.bottom)&&i.closeMenu()}},i.menu.body()))}},qe={view({attrs:{node:i,workbench:e,expanded:t,level:n},state:o}){o.expanded=o.expanded===void 0?t:o.expanded;let r=i.childCount>0&&n<3,s=a(d=>{r&&(o.expanded?o.expanded=!1:o.expanded=!0,d.stopPropagation())},"toggle"),l=a(d=>{document.querySelector(".mobile-nav").offsetHeight&&(document.querySelector(".sidebar").style.display="none"),e.open(i)},"open");return m("div",null,m("div",{class:"sidebar-item flex"},m("svg",{onclick:s,class:"feather feather-chevron-right shrink-0",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",xmlns:"http://www.w3.org/2000/svg"},r?o.expanded?m("polyline",{points:"6 9 12 15 18 9"}):m("polyline",{points:"9 18 15 12 9 6"}):null),m("div",{class:"sidebar-item-label grow",onclick:l,style:{cursor:"pointer",maxWidth:"100%",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}},i.name)),o.expanded&&m("div",{class:"sidebar-item-nested"},i.children.filter(d=>d.name!=="").map(d=>m(qe,{workbench:e,node:d,level:n+1}))))}};var W=class{constructor(){this.code="",this.language=""}childrenView(){return tt}handleIcon(e=!1){return m("svg",{xmlns:"http://www.w3.org/2000/svg",width:"15",height:"15",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"node-bullet"},m("polyline",{points:"16 18 22 12 16 6"}),m("polyline",{points:"8 6 2 12 8 18"}))}static initialize(e){e.commands.registerCommand({id:"make-code-snippet",title:"Make Code Snippet",when:t=>!(!t.node||t.node.raw.Rel==="Fields"||t.node.parent&&t.node.parent.hasComponent(Document)),action:t=>{let n=new W;t.node.addComponent(n),t.node.changed(),e.workspace.setExpanded(t.path.head,t.path.node,!0)}})}};a(W,"CodeBlock"),W=N([S],W);var tt={oncreate({dom:i,attrs:{path:e}}){let t=e.node.getComponent(W);i.jarEditor=new window.CodeJar(i,n=>{n.textContent=n.textContent,window.hljs.highlightBlock(n),t.language=window.hljs.highlightAuto(n.textContent).language||""}),i.jarEditor.updateCode(t.code),i.jarEditor.onUpdate(n=>{t.code=n,e.node.changed()})},view({attrs:{workbench:i,path:e}}){return m("div",{class:"code-editor",onkeydown:a(n=>n.stopPropagation(),"onkeydown")})}};var q=class{constructor(){this.url="https://example.com"}childrenView(){return nt}handleIcon(e=!1){return m("svg",{xmlns:"http://www.w3.org/2000/svg",width:"15",height:"15",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"node-bullet"},m("circle",{cx:"12",cy:"12",r:"10"}),m("line",{x1:"2",y1:"12",x2:"22",y2:"12"}),m("path",{d:"M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"}))}static initialize(e){e.commands.registerCommand({id:"make-iframe",title:"Make Inline Frame",when:t=>!(!t.node||t.node.raw.Rel==="Fields"||t.node.parent&&t.node.parent.hasComponent(Document)),action:t=>{let n=new q;(t.node.name.startsWith("http://")||t.node.name.startsWith("https://"))&&(n.url=t.node.name,t.node.addComponent(n),e.defocus(),t.node.name=t.node.name.replaceAll("https://","").replaceAll("http://"),e.workspace.setExpanded(t.path.head,t.node,!0),e.focus(t.path))}})}};a(q,"InlineFrame"),q=N([S],q);var nt={view({attrs:{path:i}}){let e=i.node.getComponent(q);return m("div",{class:"iframe-view"},m("iframe",{src:e.url,style:{width:"100%",height:"500px",border:"0",marginLeft:"-0.5rem"}}))}};var P=class{constructor(){this.checked=!1}beforeEditor(){return ot}};a(P,"Checkbox"),P=N([S],P);var ot={view({attrs:{node:i}}){return m("input",{type:"checkbox",style:{marginTop:"0.3rem"},onclick:a(t=>{let n=i.getComponent(P);n.checked=!n.checked,i.changed()},"toggleCheckbox"),checked:i.getComponent(P).checked})}};var z=class{constructor(){}handleIcon(){return m("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},m("polyline",{points:"4 7 4 4 20 4 20 7"}),m("line",{x1:"9",y1:"20",x2:"15",y2:"20"}),m("line",{x1:"12",y1:"4",x2:"12",y2:"20"}))}};a(z,"TextField"),z=N([S],z);var D=class{constructor(){this.log=[],this.showLog=!1}onAttach(e){this.component=e,this.object=e.parent}fromJSON(e){e.startedAt&&(this.startedAt=new Date(e.startedAt)),this.log=(e.log||[]).map(t=>[new Date(t[0]),new Date(t[1])]),this.showLog=e.showLog}toJSON(e){return{startedAt:this.startedAt,log:this.log,showLog:this.showLog}}localTotal(){return this.log.map(this.entryDuration).reduce((e,t)=>e+t,0)}grandTotal(){let e=this.localTotal();return this.object&&this.object.children.forEach(t=>{t.hasComponent(D)&&(e+=t.getComponent(D).grandTotal())}),e}start(){this.startedAt||(this.startedAt=new Date)}stop(){if(!this.startedAt)return;let e=new Date;(e.getTime()-this.startedAt.getTime())/1e3>=60&&this.log.push([this.startedAt,e]),this.startedAt=void 0}formatEntry(e){return e.length!==2?"":`${this.formatDate(e[0])} - ${new Intl.DateTimeFormat("en",{timeStyle:"short"}).format(e[1])}`}entryDuration(e){let t=e[0];return((e[1]||new Date).getTime()-t.getTime())/1e3}formatDate(e){return e?new Intl.DateTimeFormat("en",{dateStyle:"short",timeStyle:"short"}).format(e):""}formatDuration(e){let t=e/60,n=Math.floor(t%60);return t=t/60,`${Math.floor(t%60)}:${n.toLocaleString("en-US",{minimumIntegerDigits:2,useGrouping:!1})}`}afterEditor(){return rt}belowEditor(){return it}static initialize(e){e.commands.registerCommand({id:"stop-clock",title:"Stop clock",when:t=>!(!t.node||t.node.raw.Rel==="Fields"||t.node.parent&&t.node.parent.hasComponent(Document)),action:t=>{if(!t.node.hasComponent(D)){let n=new D;t.node.addComponent(n)}t.node.getComponent(D).stop(),t.node.changed()}}),e.keybindings.registerBinding({command:"stop-clock",key:"meta+o"}),e.commands.registerCommand({id:"start-clock",title:"Start clock",when:t=>!(!t.node||t.node.raw.Rel==="Fields"||t.node.parent&&t.node.parent.hasComponent(Document)),action:t=>{if(!t.node.hasComponent(D)){let n=new D;t.node.addComponent(n)}t.node.getComponent(D).start(),t.node.changed()}}),e.keybindings.registerBinding({command:"start-clock",key:"meta+i"}),e.commands.registerCommand({id:"remove-clock",title:"Remove clock",when:t=>!t.node||t.node.raw.Rel==="Fields"||t.node.parent&&t.node.parent.hasComponent(Document)?!1:!!t.node.hasComponent(D),action:t=>{t.node.removeComponent(D)}})}};a(D,"Clock"),D=N([S],D);var rt={view({attrs:{node:i}}){let e=i.getComponent(D),t=a(()=>{e.showLog=!e.showLog,i.changed()},"toggleLog");return!e.showLog&&e.startedAt?m("div",{tabindex:"1",onclick:t,class:"badge flex flex-row items-center",style:{background:"green",lineHeight:"var(--body-line-height)",paddingLeft:"0.25rem",paddingRight:"0.25rem",borderRadius:"4px",color:"white"}},m("svg",{class:"blink",style:{width:"1rem",height:"1rem",marginRight:"0.25rem"},xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},m("circle",{cx:"12",cy:"12",r:"10"}),m("polyline",{points:"12 6 12 12 16 14"})),m("div",null,e.formatDuration(e.entryDuration([e.startedAt])))):m("div",{tabindex:"1",onclick:t,class:"badge flex flex-row items-center",style:{background:"gray",lineHeight:"var(--body-line-height)",paddingLeft:"0.25rem",paddingRight:"0.25rem",borderRadius:"4px",color:"white"}},m("svg",{style:{width:"1rem",height:"1rem",marginRight:"0.25rem"},xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},m("circle",{cx:"12",cy:"12",r:"10"}),m("polyline",{points:"12 6 12 12 16 14"})),m("div",null,e.formatDuration(e.grandTotal())))}},it={view({attrs:{node:i}}){let e=i.getComponent(D);if(e.showLog)return m("div",{class:"expanded-node flex flex-row"},m("div",{class:"indent flex"}),m("div",{class:"grow"},e.startedAt&&m("div",{class:"flex flex-row",style:{marginBottom:"2px"}},m("div",{class:"grow"},e.formatDate(e.startedAt)," - ..."),m("div",{class:"flex flex-row items-center",style:{background:"green",lineHeight:"var(--body-line-height)",paddingLeft:"0.25rem",paddingRight:"0.25rem",borderRadius:"4px",color:"white"}},m("svg",{class:"blink",style:{width:"1rem",height:"1rem",marginRight:"0.25rem"},xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},m("circle",{cx:"12",cy:"12",r:"10"}),m("polyline",{points:"12 6 12 12 16 14"})),m("div",null,e.formatDuration(e.entryDuration([e.startedAt]))))),e.log.toReversed().map(t=>m("div",{class:"flex flex-row",style:{marginBottom:"2px"}},m("div",{class:"grow"},e.formatEntry(t)),m("div",{class:"flex flex-row items-center",style:{background:"#aaa",lineHeight:"var(--body-line-height)",paddingLeft:"0.25rem",paddingRight:"0.25rem",borderRadius:"4px",color:"white"}},m("svg",{style:{width:"1rem",height:"1rem",marginRight:"0.25rem"},xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},m("circle",{cx:"12",cy:"12",r:"10"}),m("polyline",{points:"12 6 12 12 16 14"})),m("div",null,e.formatDuration(e.entryDuration(t))))))))}};var ne=class{constructor(){this.auth=null,this.files=new pe,window.MiniSearch?this.index=new de:this.index=new ue}};a(ne,"BrowserBackend");var de=class{constructor(){this.indexer=new MiniSearch({idField:"ID",fields:["ID","Name","Value","Value.markdown"],storeFields:["ID"],extractField:(e,t)=>t.split(".").reduce((n,o)=>n&&n[o],e)})}index(e){this.indexer.has(e.ID)?this.indexer.replace(e):this.indexer.add(e)}remove(e){try{this.indexer.discard(e)}catch{}}search(e){let t=this.indexer.autoSuggest(e);return t.length===0?[]:this.indexer.search(t[0].suggestion,{prefix:!0,combineWith:"AND"}).map(n=>n.ID)}};a(de,"SearchIndex_MiniSearch");var ue=class{constructor(){this.nodes={}}index(e){this.nodes[e.ID]=e.Name}remove(e){delete this.nodes[e]}search(e){let t=[];for(let n in this.nodes)this.nodes[n].includes(e)&&t.push(n);return t}};a(ue,"SearchIndex_Dumb");var pe=class{async readFile(e){return localStorage.getItem(`treehouse:${e}`)}async writeFile(e,t){localStorage.setItem(`treehouse:${e}`,t)}};a(pe,"FileStore");import{encode as st,decode as at}from"https://cdn.jsdelivr.net/npm/js-base64@3.7.5/base64.mjs";var he=class{constructor(e,t,n){this.loginURL=e,this.clientFactory=t,this.auth=this,this.shas={},this.opts=Object.assign({domain:"treehouse.sh",checkDomain:!1,privateRepo:!1},n||{});let o=new ne;this.index=o.index,this.files=o.files}get repoName(){return`${this.user?.userID().toLowerCase()}.${this.opts.domain}`}async initialize(){let e=new URL(location.href).searchParams.get("code");if(e)try{let r=location.search.replace(/\bcode=\w+/,"").replace(/\?$/,"");history.pushState({},"",`${location.pathname}${r}`);let l=await(await fetch(this.loginURL,{method:"POST",mode:"cors",headers:{"content-type":"application/json"},body:JSON.stringify({code:e})})).json();if(l.error)throw l.error;localStorage.setItem("treehouse:gh-token",l.token)}catch(r){this.reset(),console.error(r);return}let t=new URL(location.href).searchParams.get("access_token");if(t)try{let r=location.search.replace(/\baccess_token=\w+/,"").replace(/\?$/,"");history.pushState({},"",`${location.pathname}${r}`),localStorage.setItem("treehouse:gh-token",t)}catch(r){this.reset(),console.error(r);return}try{if(await this.authenticate(),!this.user)throw"authentication failed"}catch(r){console.error(r),this.opts.authFallbackURL&&(location.href=this.opts.authFallbackURL);return}if(this.opts.checkDomain&&this.repoName!==location.hostname.toLowerCase()){location.hostname=this.repoName;return}try{await this.client.rest.repos.get({owner:this.user.userID(),repo:this.repoName})}catch(r){if(r.message!=="Not Found")throw r;console.log("Creating repository...");let s=await this.client.rest.repos.createForAuthenticatedUser({name:this.repoName,private:this.opts.privateRepo});if(s.status!==201){console.error(s);return}}try{await this.client.rest.repos.getContent({owner:this.user.userID(),repo:this.repoName,path:"workspace.json"})}catch(r){if(r.name!=="HttpError")throw r;console.log("Creating workspace.json...");let s=await this.client.rest.repos.createOrUpdateFileContents({owner:this.user.userID(),repo:this.repoName,path:"workspace.json",message:"initial commit",content:btoa(JSON.stringify([]))});if(s.status!==201){console.error(s);return}}this.files=this;let n=dt();await this.readFile("treehouse.lock"),await this.writeFile("treehouse.lock",n);let o=setInterval(async()=>{await this.readFile("treehouse.lock")!==n&&(clearInterval(o),document.dispatchEvent(new CustomEvent("BackendError")),console.warn("lock stolen!"))},5e3)}async loadExtensions(){try{if((await this.client.rest.repos.getContent({owner:this.user?.userID(),repo:this.repoName,path:"",random:Math.random().toString(36).substring(2)})).data.find(t=>t.type==="dir"&&t.name==="ext")){let t=await this.client.rest.repos.getContent({owner:this.user?.userID(),repo:this.repoName,path:"ext",random:Math.random().toString(36).substring(2)});for(let n of t.data)if(n.name.endsWith(".css")){let o=await this.client.rest.repos.getContent({owner:this.user?.userID(),repo:this.repoName,path:n.path,random:Math.random().toString(36).substring(2)}),r=document.createElement("link");r.setAttribute("href",`data:text/css;charset=utf-8;base64,${o.data.content}`),r.setAttribute("rel","stylesheet"),r.setAttribute("type","text/css"),document.head.appendChild(r)}else if(n.name.endsWith(".js")){let o=await this.client.rest.repos.getContent({owner:this.user?.userID(),repo:this.repoName,path:n.path,random:Math.random().toString(36).substring(2)}),r=document.createElement("script");r.setAttribute("type","module"),r.setAttribute("src",`data:text/javascript;charset=utf-8;base64,${o.data.content}`),document.head.appendChild(r)}}}catch{}}async authenticate(){let e=localStorage.getItem("treehouse:gh-token");if(!e)return;this.client=new this.clientFactory({auth:e});let t=await this.client.rest.users.getAuthenticated();!t||t.error||(this.user=new me(t.data),m&&m.redraw())}currentUser(){return this.user}login(){location.assign(this.loginURL)}reset(){localStorage.removeItem("treehouse:gh-token"),this.user=null,m&&m.redraw()}logout(){this.reset(),location.reload()}async readFile(e){try{let t=await this.client.rest.repos.getContent({owner:this.user?.userID(),repo:this.repoName,path:e,random:Math.random().toString(36).substring(2)});return this.shas[e]=t.data.sha,at(t.data.content)}catch(t){return t.name!=="HttpError"&&console.error(t),null}}async writeFile(e,t){let n=await this.client.rest.repos.createOrUpdateFileContents({owner:this.user?.userID(),repo:this.repoName,path:e,message:"autosave",content:st(t),sha:this.shas[e]});this.shas[e]=n.data.content.sha}};a(he,"GitHubBackend");var me=class{constructor(e){this.user=e}userID(){return this.user.login}displayName(){return this.user.name}avatarURL(){return this.user.avatar_url}};a(me,"User");function dt(){let i=Date.now().toString(36),e=Math.random().toString(36).substring(2);return i+e}a(dt,"uniqueID");async function kr(i,e,t){t.initialize&&await t.initialize();let n=new _(t);window.workbench=n,await n.initialize(),[D,z,C,P,T,M,$,L,q,W].forEach(o=>{o.initialize&&o.initialize(n)}),i.addEventListener("BackendError",()=>{n.showNotice("lockstolen",()=>{location.reload()})}),n.commands.registerCommand({id:"cut",title:"Cut",when:o=>{if(!o.node)return!1;let r=n.getInput(o.path);return r&&r.selectionStart===r.selectionEnd?!0:(n.clipboard=void 0,!1)},action:o=>{n.clipboard={op:"cut",node:o.node}}}),n.keybindings.registerBinding({command:"cut",key:"meta+x"}),n.commands.registerCommand({id:"copy",title:"Copy",when:o=>{if(!o.node)return!1;let r=n.getInput(o.path);return r&&r.selectionStart===r.selectionEnd?!0:(n.clipboard=void 0,!1)},action:o=>{n.clipboard={op:"copy",node:o.node}}}),n.keybindings.registerBinding({command:"copy",key:"meta+c"}),n.commands.registerCommand({id:"copy-reference",title:"Copy as Reference",when:o=>{if(!o.node)return!1;let r=n.getInput(o.path);return r&&r.selectionStart===r.selectionEnd?!0:(n.clipboard=void 0,!1)},action:o=>{n.clipboard={op:"copyref",node:o.node}}}),n.keybindings.registerBinding({command:"copy-reference",key:"shift+ctrl+c"}),n.commands.registerCommand({id:"paste",title:"Paste",when:o=>!!n.clipboard,action:o=>{if(!o.node||o.path.previous&&B(o.path.previous))return;switch(n.clipboard.op){case"copy":n.clipboard.node=n.clipboard.node.duplicate();break;case"copyref":let s=n.workspace.new("");s.refTo=n.clipboard.node,n.clipboard.node=s;break}n.clipboard.node.raw.Rel==="Fields"?(n.clipboard.node.raw.Parent=o.node.parent.id,o.node.parent.addLinked("Fields",n.clipboard.node)):(n.clipboard.node.parent=o.node.parent,n.clipboard.node.siblingIndex=o.node.siblingIndex),m.redraw.sync();let r=o.path.clone();r.pop(),n.focus(r.append(n.clipboard.node)),n.clipboard.op==="cut"&&(n.clipboard=void 0)}}),n.keybindings.registerBinding({command:"paste",key:"meta+v"}),n.commands.registerCommand({id:"view-list",title:"View as List",when:o=>!(!o.node||o.node.raw.Rel==="Fields"||o.node.parent&&o.node.parent.hasComponent(C)),action:o=>{o.node.setAttr("view","list")}}),n.commands.registerCommand({id:"view-table",title:"View as Table",when:o=>!(!o.node||o.node.raw.Rel==="Fields"||o.node.parent&&o.node.parent.hasComponent(C)),action:o=>{o.node.setAttr("view","table"),o.node.children.forEach(r=>{n.workspace.setExpanded(o.path.head,r,!1)})}}),n.commands.registerCommand({id:"view-tabs",title:"View as Tabs",when:o=>!(!o.node||o.node.raw.Rel==="Fields"||o.node.parent&&o.node.parent.hasComponent(C)),action:o=>{o.node.setAttr("view","tabs")}}),n.commands.registerCommand({id:"add-checkbox",title:"Add checkbox",when:o=>!(!o.node||o.node.hasComponent(P)||o.node.raw.Rel==="Fields"||o.node.parent&&o.node.parent.hasComponent(C)),action:o=>{let r=new P;o.node.addComponent(r)}}),n.commands.registerCommand({id:"remove-checkbox",title:"Remove checkbox",when:o=>!o.node||o.node.raw.Rel==="Fields"||o.node.parent&&o.node.parent.hasComponent(C)?!1:!!o.node.hasComponent(P),action:o=>{o.node.removeComponent(P)}}),n.commands.registerCommand({id:"create-field",title:"Create Field",action:o=>{if(!o.node||o.node.childCount>0||o.node.componentCount>0||o.path.previous&&B(o.path.previous))return;let r=o.path.clone();r.pop();let s=n.workspace.new(o.node.name,"");s.raw.Parent=o.node.parent.id;let l=new z;s.addComponent(l),o.node.parent.addLinked("Fields",s),r.push(s),o.node.destroy(),m.redraw.sync(),n.focus(r)}}),n.commands.registerCommand({id:"mark-done",title:"Mark Done",when:o=>!(!o.node||o.node.raw.Rel==="Fields"||o.node.parent&&o.node.parent.hasComponent(C)),action:o=>{if(o.node)if(o.node.hasComponent(P)){let r=o.node.getComponent(P);r.checked?o.node.removeComponent(P):(r.checked=!0,o.node.changed())}else{let r=new P;o.node.addComponent(r)}}}),n.keybindings.registerBinding({command:"mark-done",key:"meta+enter"}),n.commands.registerCommand({id:"expand",title:"Expand",action:o=>{o.node&&(n.workspace.setExpanded(o.path.head,o.node,!0),m.redraw())}}),n.keybindings.registerBinding({command:"expand",key:"meta+arrowdown"}),n.commands.registerCommand({id:"collapse",title:"Collapse",action:o=>{o.node&&(n.workspace.setExpanded(o.path.head,o.node,!1),m.redraw())}}),n.keybindings.registerBinding({command:"collapse",key:"meta+arrowup"}),n.commands.registerCommand({id:"indent",title:"Indent",when:o=>!(!o.node||o.node.raw.Rel==="Fields"||o.node.parent&&o.node.parent.hasComponent(C)),action:o=>{let r=o.node,s=o.path.clone(),l=r.prevSibling;for(;l&&B(l);)if(l=l.prevSibling,!l)return;l!==null&&(s.pop(),s.push(l),r.parent=l,s.push(r),n.workspace.setExpanded(o.path.head,l,!0),m.redraw.sync(),n.focus(s))}}),n.keybindings.registerBinding({command:"indent",key:"tab"}),n.commands.registerCommand({id:"outdent",title:"Outdent",when:o=>!(!o.node||o.node.raw.Rel==="Fields"||o.path.previous&&B(o.path.previous)||o.node.parent&&o.node.parent.hasComponent(C)),action:o=>{let r=o.node,s=o.path.previous,l=o.path.clone();s!==null&&s.id!=="@root"&&s.id!==n.workspace.lastOpenedID&&(l.pop(),l.pop(),r.parent=s.parent,l.push(r),r.siblingIndex=s.siblingIndex+1,s.childCount===0&&s.getLinked("Fields").length===0&&n.workspace.setExpanded(o.path.head,s,!1),m.redraw.sync(),n.focus(l))}}),n.keybindings.registerBinding({command:"outdent",key:"shift+tab"}),n.commands.registerCommand({id:"move-up",title:"Move Up",action:o=>{if(!o.node)return;let r=o.node,s=r.parent;if(s!==null&&s.id!=="@root"){let l=s.childCount;if(r.siblingIndex===0){if(!s.prevSibling)return;let d=o.path.clone();d.pop(),d.pop();let c=s.prevSibling;for(;c&&B(c);)if(c=c.prevSibling,!c)return;d.push(c),d.push(r),r.parent=c,r.siblingIndex=c.childCount-1,n.workspace.setExpanded(o.path.head,c,!0),m.redraw.sync(),n.focus(d)}else{if(l===1)return;r.siblingIndex=r.siblingIndex-1,m.redraw.sync()}}}}),n.keybindings.registerBinding({command:"move-up",key:"shift+meta+arrowup"}),n.commands.registerCommand({id:"move-down",title:"Move Down",action:o=>{if(!o.node)return;let r=o.node,s=r.parent;if(s!==null&&s.id!=="@root"){let l=s.childCount;if(r.siblingIndex===l-1){if(!s.nextSibling)return;let d=o.path.clone();d.pop(),d.pop();let c=s.nextSibling;for(;c&&B(c);)if(c=c.nextSibling,!c)return;d.push(c),d.push(r),r.parent=c,r.siblingIndex=0,n.workspace.setExpanded(o.path.head,c,!0),m.redraw.sync(),n.focus(d)}else{if(l===1)return;r.siblingIndex=r.siblingIndex+1,m.redraw.sync()}}}}),n.keybindings.registerBinding({command:"move-down",key:"shift+meta+arrowdown"}),n.commands.registerCommand({id:"insert-child",title:"Insert Child",action:(o,r="",s)=>{if(!o.node||B(o.node))return;let l=n.workspace.new(r);l.parent=o.node,s!==void 0&&(l.siblingIndex=s),n.workspace.setExpanded(o.path.head,o.node,!0),m.redraw.sync(),n.focus(o.path.append(l),r.length)}}),n.commands.registerCommand({id:"insert-before",title:"Insert Before",action:o=>{if(!o.node||o.path.previous&&B(o.path.previous))return;let r=n.workspace.new("");r.parent=o.node.parent,r.siblingIndex=o.node.siblingIndex,m.redraw.sync();let s=o.path.clone();s.pop(),n.focus(s.append(r))}}),n.commands.registerCommand({id:"insert",title:"Insert Node",action:(o,r="")=>{if(!o.node||o.path.previous&&B(o.path.previous))return;let s=n.workspace.new(r);s.parent=o.node.parent,s.siblingIndex=o.node.siblingIndex+1,m.redraw.sync();let l=o.path.clone();l.pop(),n.focus(l.append(s))}}),n.keybindings.registerBinding({command:"insert",key:"shift+enter"}),n.commands.registerCommand({id:"create-reference",title:"Create Reference",action:o=>{if(!o.node||o.path.previous&&B(o.path.previous))return;let r=n.workspace.new("");r.parent=o.node.parent,r.siblingIndex=o.node.siblingIndex+1,r.refTo=o.node,m.redraw.sync();let s=o.path.clone();s.pop(),n.focus(s.append(r))}}),n.commands.registerCommand({id:"delete",title:"Delete Node",action:o=>{if(!o.node||o.node.id.startsWith("@")||o.path.previous&&B(o.path.previous))return;let r=n.workspace.findAbove(o.path);if(o.node.destroy(),m.redraw.sync(),r){let s=0;o.event&&o.event.key==="Backspace"&&(r.node.value?s=r.node.value.length:s=r.node.name.length),r.node.childCount===0&&n.workspace.setExpanded(o.path.head,r.node,!1),n.focus(r,s)}}}),n.keybindings.registerBinding({command:"delete",key:"shift+meta+backspace"}),n.commands.registerCommand({id:"prev",title:"Previous Node",action:o=>{if(!o.node)return;let r=n.workspace.findAbove(o.path);r&&n.focus(r)}}),n.keybindings.registerBinding({command:"prev",key:"arrowup"}),n.commands.registerCommand({id:"next",title:"Next Node",action:o=>{if(!o.node)return;let r=n.workspace.findBelow(o.path);r&&n.focus(r)}}),n.keybindings.registerBinding({command:"next",key:"arrowdown"}),n.commands.registerCommand({id:"pick-command",title:"Command Palette",hidden:!0,when:o=>!n.isDialogOpen(),action:o=>{let r=o.node,s=o.path,l=!1;r||(r=o.path.head,s=new O(o.path.head,o.path.name),l=!0);let d=n.getInput(s),c=d.getBoundingClientRect(),h=i.body.scrollLeft+c.x+d.selectionStart*10+20,p=i.body.scrollTop+c.y-8;d.coordsAtCursor&&(h=d.coordsAtCursor.left-17,p=d.coordsAtCursor.top-16),l&&(h=i.body.scrollLeft+c.x,p=i.body.scrollTop+c.y+c.height),n.showPalette(h,p,n.newContext({node:r}))}}),n.keybindings.registerBinding({command:"pick-command",key:"meta+k"}),n.commands.registerCommand({id:"new-panel",title:"Open in New Panel",action:o=>{o.node&&(n.openNewPanel(o.node),m.redraw())}}),n.commands.registerCommand({id:"close-panel",title:"Close Panel",action:(o,r)=>{n.closePanel(r||o.path),n.context.path=n.mainPanel,m.redraw()}}),n.commands.registerCommand({id:"zoom",title:"Open",action:o=>{n.workspace.lastOpenedID=o.node.id,n.workspace.save(),n.context.path=o.path.append(o.node),n.panels[0]=n.context.path,m.redraw()}}),n.commands.registerCommand({id:"generate-random",hidden:!0,title:"Generate Random Children",action:o=>{o.node&&[...Array(100)].forEach(()=>{let r=n.workspace.new(lt(8));r.parent=o.node})}}),n.menus.registerMenu("node",[{command:"zoom"},{command:"new-panel"},{command:"cut"},{command:"copy"},{command:"paste"},{command:"indent"},{command:"outdent"},{command:"move-up"},{command:"move-down"},{command:"delete"}]),n.menus.registerMenu("settings",[{title:()=>`${n.backend.auth?.currentUser()?.userID()} @ GitHub`,disabled:!0,when:()=>n.authenticated()},{title:()=>"Login with GitHub",when:()=>!n.authenticated(),onclick:()=>{localStorage.getItem("github")?n.backend.auth.login():n.showNotice("github",()=>{n.backend.auth.login()})}},{title:()=>"Reset Demo",when:()=>!n.authenticated(),onclick:()=>{localStorage.clear(),location.reload()}},{title:()=>"Settings",onclick:()=>n.showSettings()},{title:()=>"Documentation",onclick:()=>window.open("https://treehouse.sh/docs/user","_blank")},{title:()=>"Submit Issue",onclick:()=>window.open("https://github.com/treehousedev/treehouse/issues","_blank")},{title:()=>"Logout",when:()=>n.authenticated(),onclick:()=>n.backend.auth.logout()}]),i.addEventListener("keydown",o=>{let r=n.keybindings.evaluateEvent(o);if(r&&n.canExecuteCommand(r.command,n.context)){n.executeCommand(r.command,n.context),o.stopPropagation(),o.preventDefault();return}}),m.mount(e,{view:()=>m(We,{workbench:n})})}a(kr,"setup");function lt(i=10){let e=a((o,r)=>Math.round(Math.random()*(r-o)+o),"random"),t=a(()=>{let o=["got","ability","shop","recall","fruit","easy","dirty","giant","shaking","ground","weather","lesson","almost","square","forward","bend","cold","broken","distant","adjective"];return o[e(0,o.length-1)]},"word");return a(o=>[...Array(o)].map((r,s)=>t()).join(" ").trim(),"words")(e(2,i))}a(lt,"generateName");export{ne as BrowserBackend,he as GitHubBackend,de as SearchIndex_MiniSearch,kr as setup};
//# sourceMappingURL=treehouse.min.js.map
