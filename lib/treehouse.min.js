var ge=Object.defineProperty;var We=Object.getOwnPropertyDescriptor;var a=(r,e)=>ge(r,"name",{value:e,configurable:!0});var L=(r,e,t,n)=>{for(var o=n>1?void 0:n?We(e,t):e,i=r.length-1,s;i>=0;i--)(s=r[i])&&(o=(n?s(e,t,o):s(o))||o);return n&&o&&ge(e,t,o),o};var we=navigator.userAgent.toLowerCase().indexOf("mac")!==-1;function K(r){if(!r)return[];let e={backspace:"\u232B",shift:"\u21E7",meta:"\u2318",tab:"\u21B9",ctrl:"\u2303",arrowup:"\u2191",arrowdown:"\u2193",arrowleft:"\u2190",arrowright:"\u2192",enter:"\u23CE"};return r.toLowerCase().split("+").map(ve).map(n=>Object.keys(e).includes(n)?e[n]:n)}a(K,"bindingSymbols");function ve(r){return!we&&r==="meta"?"ctrl":r}a(ve,"filterKeyForNonMacMeta");var ee=class{constructor(){this.bindings=[]}registerBinding(e){this.bindings.push(e)}getBinding(e){for(let t of this.bindings)if(t.command===e)return t;return null}evaluateEvent(e){e:for(let t of this.bindings){let n=t.key.toLowerCase().split("+");if(n.pop()===e.key.toLowerCase()){for(let i of["shift","ctrl","alt","meta"]){let s=n.includes(i);if(!we){if(i==="meta")continue;i==="ctrl"&&(s=n.includes("meta")||n.includes("ctrl"))}let l=e[`${ve(i)}Key`];if(!l&&s||l&&!s)continue e}return t}}return null}};a(ee,"KeyBindings");var te=class{constructor(){this.commands={}}registerCommand(e){this.commands[e.id]=e}canExecuteCommand(e,...t){return this.commands[e]?!(this.commands[e].when&&!this.commands[e].when(...t)):!1}executeCommand(e,...t){return new Promise(n=>{let o=this.commands[e].action(...t);n(o)})}};a(te,"CommandRegistry");var ne=class{constructor(){this.menus={}}registerMenu(e,t){this.menus[e]=t}};a(ne,"MenuRegistry");function ke(r,e,t,n){return t?e.disabled||!r.canExecuteCommand(t.id,n):e.disabled}a(ke,"isDisabled");var ye={view({attrs:{workbench:r,x:e,y:t,items:n,align:o,commands:i,ctx:s}}){let l=a((d,u)=>h=>{h.stopPropagation(),!ke(r,d,u,s)&&(r.closeMenu(),d.onclick&&d.onclick(),u&&r.executeCommand(u.id,s))},"onclick");return m("ul",{class:"menu",style:{margin:"0",display:"inline-block"}},n.filter(d=>!d.when||d.when()).map(d=>{let u="",h,p;return d.command&&(p=i.find(b=>b.id===d.command),h=r.keybindings.getBinding(p.id),u=p.title),d.title&&(u=d.title()),m("li",{onclick:l(d,p),class:ke(r,d,p,s)?"disabled":"",style:{display:"flex"}},m("div",null,u),h&&m("div",{class:"keybindings grow text-right"},K(h.key).join(" ").toUpperCase()))}))}};var J={onupdate({state:r,dom:e}){let t=e.querySelector(".items").children;r.selected!==void 0&&t.length>0&&t[r.selected].scrollIntoView({block:"nearest"})},oncreate({attrs:r,state:e,dom:t}){r.inputview&&t.querySelector("input")?.focus(),e.selected===void 0&&(e.selected=0)},view({attrs:r,state:e}){e.selected=e.selected===void 0?0:e.selected,e.input=e.input===void 0?r.input||"":e.input,e.items===void 0&&(e.items=[],r.onchange(e));let t=a(o=>{let i=a((s,l)=>(s%l+l)%l,"mod");if(o.key==="ArrowDown")return e.selected===void 0?(e.selected=0,!1):(e.selected=i(e.selected+1,e.items.length),!1);if(o.key==="ArrowUp")return e.selected===void 0&&(e.selected=0),e.selected=i(e.selected-1,e.items.length),!1;if(o.key==="Enter")return e.selected!==void 0&&r.onpick(e.items[e.selected]),!1},"onkeydown"),n=a(o=>{e.input=o.target.value,e.selected=0,r.onchange(e)},"oninput");return m("div",{class:"picker"},r.inputview(t,n,e.input),m("div",{class:"items"},e.items.map((o,i)=>m("div",{class:e.selected===i?"item selected":"item",onclick:()=>r.onpick(o),onmouseover:()=>e.selected=i},r.itemview(o,i)))))}};var be={view({attrs:{workbench:r,ctx:e}}){let t=a(d=>(d.title||d.id).replace("-"," ").replace(/(^|\s)\S/g,h=>h.toUpperCase()),"getTitle"),n=a((d,u)=>t(d).localeCompare(t(u)),"sort"),o=a(d=>{r.closeDialog(),r.commands.executeCommand(d.id,e)},"onpick"),i=a(d=>{d.items=l.filter(u=>(u.title||u.id).toLowerCase().includes(d.input.toLowerCase()))},"onchange"),s=a(d=>{let u=r.keybindings.getBinding(d.id);return u?K(u.key).join(" ").toUpperCase():""},"getBindingSymbols"),l=Object.values(r.commands.commands).filter(d=>!d.hidden).filter(d=>r.canExecuteCommand(d.id,e)).sort(n);return m("div",{class:"palette"},m(J,{onpick:o,onchange:i,inputview:(d,u)=>m("div",null,m("input",{style:{width:"98%"},type:"text",onkeydown:d,oninput:u,placeholder:"Enter command..."})),itemview:d=>m("div",{class:"flex"},m("div",null,t(d)),m("div",{class:"keybindings grow text-right"},s(d)))}))}};function z(r,e){return r.value&&r.value[e]instanceof Function}a(z,"hasHook");function V(r,e,...t){if(z(r,e))return r.value[e].apply(r.value,t)}a(V,"triggerHook");function $(r,e){for(let t of r.components)if(z(t,e))return!0;return!1}a($,"objectHas");function oe(r,e,...t){for(let n of r.components)if(z(n,e))return n.value[e].apply(n.value,t)}a(oe,"objectCall");function se(r,e,...t){let n=[];for(let o of r.components)z(o,e)&&n.push(o.value);return n}a(se,"componentsWith");function M(r){return $(r,"objectChildren")}a(M,"objectManaged");var he={};function E(r){he[Q(r)]=r}a(E,"component");function Q(r){return r.prototype===void 0&&(r=r.constructor),`treehouse.${r.name}`}a(Q,"componentName");function Y(r){return typeof r=="string"?he[r]:he[Q(r)]}a(Y,"getComponent");function xe(r,e){let t=new(Y(r));return t.fromJSON instanceof Function?t.fromJSON(e):Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)),t}a(xe,"inflateToComponent");function Ce(r){if(r===void 0)return;if(!Y(r))return structuredClone(r);let t=JSON.parse(JSON.stringify(r)||""),n=new r.constructor;return n.fromJSON instanceof Function?n.fromJSON(t):Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)),n}a(Ce,"duplicate");var C=class{constructor(){}onAttach(e){this.object=e.parent,this.object.setAttr("view","document")}handleIcon(e=!1){return m("svg",{xmlns:"http://www.w3.org/2000/svg",width:"15",height:"15",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"node-bullet"},m("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),m("polyline",{points:"14 2 14 8 20 8"}),m("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),m("line",{x1:"16",y1:"17",x2:"8",y2:"17"}),m("polyline",{points:"10 9 9 9 8 9"}))}toJSON(e){return{}}static initialize(e){e.commands.registerCommand({id:"make-document",title:"Make Document",action:t=>{if(!t.node)return;let n=new C;t.node.addComponent(n),t.node.changed(),e.executeCommand("zoom",t)}})}};a(C,"Document"),C=L([E],C);var W={view({attrs:{workbench:r,path:e,onkeydown:t,oninput:n,disallowEmpty:o,editValue:i,placeholder:s},state:l}){let d=e.node,u=i?"value":"name",h=a(()=>u==="name"?$(d,"displayName")?oe(d,"displayName",d):d.name:d[u]||"","display"),p=a(()=>{l.initialValue=d[u],r.context.node=d,r.context.path=e},"onfocus"),b=a(()=>d[u],"getter"),I=a((f,x)=>{d.isDestroyed||(o&&f.length===0?d[u]=l.initialValue:d[u]=f),x&&(r.context.node=null)},"setter");d.raw.Rel==="Fields"&&(s=i?"Value":"Field");let v=`input-${e.id}-${d.id}`;u==="value"&&(v=v+"-value");let w=Ue;return d.parent&&d.parent.hasComponent(C)&&window.Editor&&(w=qe),m(w,{id:v,getter:b,setter:I,display:h,onkeydown:t,onfocus:p,oninput:n,placeholder:s,workbench:r,path:e})}},qe={oncreate({dom:r,state:e,attrs:{id:t,onkeydown:n,onfocus:o,onblur:i,oninput:s,getter:l,setter:d,display:u,placeholder:h}}){let p=e.editing?e.buffer:u?u():l(),b=a(f=>{f.key==="Enter"&&(f.preventDefault(),f.stopPropagation())},"defaultKeydown"),I=a(f=>{o&&o(f),e.editing=!0,e.buffer=l()},"startEdit"),v=a(f=>{e.editing&&(e.editing=!1,d(e.buffer,!0),e.buffer=void 0),i&&i(f)},"finishEdit"),w=a(f=>{e.buffer=f.target.value,d(e.buffer,!1),s&&s(f)},"edit");e.editor=new window.Editor(r,p,h),e.editor.onblur=v,e.editor.onfocus=I,e.editor.oninput=w,e.editor.onkeydown=n||b,r.editor=e.editor,r.id=t},onupdate({dom:r,state:e,attrs:{getter:t,display:n}}){e.editor.value=e.editing?e.buffer:n?n():t()},view(){return m("div",{class:"text-editor"})}},Ue={oncreate({dom:r,attrs:e}){let t=r.querySelector("textarea"),n=t.offsetHeight,o=r.querySelector("span");this.updateHeight=()=>{o.style.width=`${Math.max(t.offsetWidth,100)}px`,o.innerHTML=t.value.replace(`
`,"<br/>");let i=o.offsetHeight;i===0&&n>0&&(i=n),t.style.height=i>0?`${i}px`:"var(--body-line-height)"},t.addEventListener("input",()=>this.updateHeight()),t.addEventListener("blur",()=>o.innerHTML=""),setTimeout(()=>this.updateHeight(),50),e.onmount&&e.onmount(t)},onupdate(){this.updateHeight()},view({attrs:{id:r,onkeydown:e,onfocus:t,onblur:n,oninput:o,getter:i,setter:s,display:l,placeholder:d,path:u,workbench:h},state:p}){let b=p.editing?p.buffer:l?l():i();return m("div",{class:"text-editor"},m("textarea",{id:r,rows:"1",onfocus:a(g=>{t&&t(g),p.editing=!0,p.buffer=i()},"startEdit"),onblur:a(g=>{p.editing&&(p.editing=!1,s(p.buffer,!0),p.buffer=void 0),n&&n(g)},"finishEdit"),oninput:a(g=>{p.buffer=g.target.value,s(p.buffer,!1),o&&o(g)},"edit"),onpaste:a(g=>{let F=g.clipboardData.getData("Text");if(F.length>0){g.preventDefault(),g.stopPropagation();let c=F.split(`
`).map(k=>k.trim()).filter(k=>k.length>0);p.buffer=c.shift(),s(p.buffer,!0);let S=u.node;for(let k of c){let y=h.workspace.new(k);y.parent=S.parent,y.siblingIndex=S.siblingIndex+1,m.redraw.sync();let D=u.clone();D.pop(),h.focus(D.append(y)),S=y}}},"handlePaste"),placeholder:d,onkeydown:e||a(g=>{g.key==="Enter"&&(g.preventDefault(),g.stopPropagation())},"defaultKeydown"),value:b},b),m("span",{style:{visibility:"hidden",position:"fixed"}}))}};var Ne={view({attrs:{node:r,workbench:e,panel:t}}){return m("div",{class:"empty-view"})}};var ae={view({attrs:{workbench:r,path:e}}){return m("div",{class:"new-node flex flex-row items-center"},m("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 16 16"},m("circle",{cx:"8",cy:"7",r:"7"}),m("path",{style:{transform:"translate(0px, -1px)"},d:"M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"})),m("div",{class:"flex grow"},m("input",{class:"grow",type:"text",onkeydown:a(n=>{if(n.key==="Tab"){if(n.stopPropagation(),n.preventDefault(),node.childCount>0){let o=e.node.children[e.node.childCount-1];r.executeCommand("insert-child",{node:o,path:e})}}else r.executeCommand("insert-child",{node:e.node,path:e},n.target.value)},"keydown"),value:""})))}};function ze(r,e=1e3){let t;return(...n)=>{clearTimeout(t),t=setTimeout(()=>{r.apply(this,n)},e)}}a(ze,"debounce");var H=class{constructor(){this.workbench=window.workbench,this.searchDebounce=ze(this.search.bind(this)),this.query="",this.initialSearch=!1}handleIcon(e=!1){return m("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",class:"node-bullet",width:"15",height:"15",fill:"none",stroke:"currentColor","stroke-width":"3","stroke-linecap":"round","stroke-linejoin":"round"},e?m("circle",{id:"node-collapsed-handle",stroke:"none",cx:"12",cy:"12",r:"12"}):null,m("svg",{xmlns:"http://www.w3.org/2000/svg",x:"3",y:"3",width:"19",height:"19",viewBox:"0 0 24 24"},m("circle",{cx:"11",cy:"11",r:"8"}),m("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})))}belowEditor(){return Ve}onAttach(e){this.component=e,this.object=e.parent,e.bus.observe(t=>{e.isDestroyed||this.searchDebounce()})}search(){if(!this.object)return;if(!this.query){this.lastQuery="",this.results=[];return}this.initialSearch=!0;let e=this.workbench.search(this.query).filter(t=>t.id!==this.object.id&&t.id!==this.component.id);(e.length!==this.lastResultCount||this.query!==this.lastQuery)&&(this.results&&this.results.forEach(t=>t.destroy()),this.results=e.map(t=>{let n=this.object.bus.make("");return n.raw.Parent="@tmp",n.refTo=t,n}),this.lastQuery=this.query,this.lastResultCount=e.length)}objectChildren(e,t){return!this.results&&this.query&&!this.initialSearch&&this.search(),this.results||[]}toJSON(e){return{query:this.query}}fromJSON(e){this.query=e.query||""}static initialize(e){e.commands.registerCommand({id:"make-smart-node",title:"Make Smart Node",when:t=>!(!t.node||t.node.raw.Rel==="Fields"||t.node.childCount>0||t.node.parent&&t.node.parent.hasComponent(Document)),action:t=>{e.defocus();let n=new H;t.node.addComponent(n),e.workspace.setExpanded(t.path.head,t.node,!0),t.node.name===""&&setTimeout(()=>{t.node.name="Unnamed Smart Node",m.redraw(),document.querySelector(`#node-${t.path.id}-${t.node.id} input`).focus()},10)}})}};a(H,"SmartNode"),H=L([E],H);var Ve={view({attrs:{node:r,component:e,expanded:t}}){if(!t)return;let n=a(o=>{e.query=o.target.value,e.search(),r.changed()},"oninput");return m("div",{class:"expanded-node flex flex-row"},m("div",{class:"indent flex"}),m("input",{type:"text",class:"grow",placeholder:"Enter search",value:e.query,oninput:n,style:{background:"inherit",border:"1px solid var(--color-outline-secondary)",outline:"0",padding:"var(--1)",marginBottom:"var(--1)",borderRadius:"var(--border-radius)"}}))}};var Se={view({attrs:{workbench:r,path:e,alwaysShowNew:t}}){let n=e.node;e.node.refTo&&(n=e.node.refTo);let o=!1;return(n.childCount===0&&n.getLinked("Fields").length===0||t)&&(o=!0),n.hasComponent(H)&&(o=!1),m("div",{class:"list-view"},m("div",{class:"fields"},n.getLinked("Fields").length>0&&n.getLinked("Fields").map(i=>m(q,{key:i.id,workbench:r,path:e.append(i)}))),m("div",{class:"children"},n.childCount>0&&n.children.map(i=>m(q,{key:i.id,workbench:r,path:e.append(i)})),o&&m(ae,{workbench:r,path:e})))}};var De={view({attrs:{workbench:r,path:e},state:t}){let n=e.node;t.fields=t.fields===void 0?new Set:t.fields,n.children.forEach(i=>{i.getLinked("Fields").forEach(s=>t.fields.add(s.name))});let o=a((i,s)=>{let l=i.getLinked("Fields").filter(d=>d.name===s);return l.length===0?"":m(W,{editValue:!0,workbench:r,path:e.append(l[0])})},"getFieldEditor");return m("table",{class:"table-view",style:{gridTemplateColumns:`repeat(${t.fields.size+1}, 1fr)`}},m("thead",null,m("tr",null,m("th",null,"Title"),[...t.fields].map(i=>m("th",null,i)))),m("tbody",null,n.children.map(i=>m("tr",null,m("td",null,m(q,{key:i.id,workbench:r,path:e.append(i)})),[...t.fields].map(s=>m("td",null,o(i,s)))))))}};var Ie={view({attrs:{workbench:r,path:e},state:t}){let n=e.node;t.tabs=t.tabs===void 0?new Set:t.tabs,t.selectedTab=t.selectedTab===void 0?"":t.selectedTab,n.children.forEach(s=>{t.tabs.add(s.raw),t.selectedTab===""&&(t.selectedTab=s.raw.ID)});let o=a(s=>{t.selectedTab=s},"handleTabClick"),i=n.children.find(s=>s.id===t.selectedTab);return m("div",{class:"tabs-view"},m("div",{class:"tabs"},[...t.tabs].map(s=>m("div",{class:s.ID===t.selectedTab?"active":"",onclick:()=>o(s.ID)},s.Name)),m("div",{style:{flexGrow:1}})),m("div",{class:"tab-content"},m(ie(i.getAttr("view")||"list"),{workbench:r,path:e.append(i)})))}};var Le={view({attrs:{workbench:r,path:e,alwaysShowNew:t}}){let n=e.node;e.node.refTo&&(n=e.node.refTo);let o=!1;return(n.childCount===0&&n.getLinked("Fields").length===0||t)&&(o=!0),m("div",{class:"document-view"},m("div",{class:"fields"},n.getLinked("Fields").length>0&&n.getLinked("Fields").map(i=>m(q,{key:i.id,workbench:r,path:e.append(i)}))),m("div",{class:"children"},n.childCount>0&&n.children.map(i=>m(q,{key:i.id,workbench:r,path:e.append(i)})),o&&m(ae,{workbench:r,path:e})))}};var Ee={list:Se,table:De,tabs:Ie,document:Le};function ie(r){return Ee[r]||Ne}a(ie,"getView");window.registerView=(r,e)=>{Ee[r]=e,workbench.commands.registerCommand({id:`view-${r}`,title:`View as ${Qe(r)}`,action:t=>{t.node&&t.node.setAttr("view",r)}})};function Qe(r){return r.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})}a(Qe,"toTitleCase");var O=class{constructor(){}onAttach(e){this.object=e.parent}handleIcon(e=!1){return m("svg",{xmlns:"http://www.w3.org/2000/svg",width:"15",height:"15",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"3","stroke-linecap":"round","stroke-linejoin":"round",class:"node-bullet"},e?m("circle",{id:"node-collapsed-handle",stroke:"none",cx:"12",cy:"12",r:"12"}):null,m("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"}),m("path",{d:"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"}))}toJSON(e){return{}}static initialize(e){e.commands.registerCommand({id:"make-template",title:"Make Template",when:t=>!(!t.node||t.node.raw.Rel==="Fields"||t.node.parent&&t.node.parent.hasComponent(Document)),action:t=>{let n=new O;t.node.addComponent(n),t.node.changed()}})}static findNode(e,t){let n=null;return e.mainNode().walk(o=>o.value instanceof O&&o.value.object.name===t?(n=o.value.object,!0):!1,{includeComponents:!0}),n}};a(O,"Template"),O=L([E],O);var A=class{constructor(e){this.name=e}afterEditor(){return Ke}static initialize(e){e.commands.registerCommand({id:"add-tag",title:"Add tag",hidden:!0,action:(t,n)=>{if(!t.node)return;let o=new A(n);t.node.addComponent(o);let i=O.findNode(e.workspace,n);i&&(i.fields.map(s=>s.duplicate()).forEach(s=>{t.node.addLinked("Fields",s),s.raw.Parent=t.node.raw.ID}),i.children.map(s=>s.duplicate()).forEach(s=>{t.node.addChild(s),s.raw.Parent=t.node.raw.ID})),t.node.changed()}})}static findAll(e){let t=new Set;return e.mainNode().walk(n=>(n.value instanceof A&&t.add(n.value.name),!1),{includeComponents:!0}),[...t]}static findTagged(e,t){let n=[];return e.mainNode().walk(o=>(o.value instanceof A&&o.value.name===t&&n.push(o.parent),!1),{includeComponents:!0}),n}static showPopover(e,t,n,o,i){let s=A.findAll(e.workspace),l=e.getInput(t),d=l.getBoundingClientRect(),u=document.body.scrollLeft+d.x+l.selectionStart*10+20,h=document.body.scrollTop+d.y+d.height;e.showPopover(()=>m(J,{onpick:p=>{i(),e.getInput(t).blur(),n.name=n.name.replace(/\s*#\w*/,""),e.executeCommand("add-tag",{node:n,path:t},p.name)},onchange:p=>{n.name.includes("#")?p.input=n.name.split("#")[1]:p.input="";let b=[...s].filter(I=>I.toLowerCase().startsWith(p.input.toLowerCase())).map(I=>({name:I}));(b[0]&&b[0].name!=p.input&&p.input!=""||b.length===0)&&b.unshift({name:p.input,prefix:"Create tag: "}),p.items=b},inputview:o,itemview:p=>m("div",{class:"flex"},m("div",null,p.prefix||"",p.name))}),{top:`${h}px`,left:`${u}px`})}};a(A,"Tag"),A=L([E],A);var Ke={view({attrs:{node:r,component:e}}){return m("div",{tabindex:"1",class:"badge flex flex-row items-center",onkeydown:a(n=>{n.key==="Backspace"&&(r.removeComponent(e),r.changed())},"onkeydown")},m("span",null,"#\xA0"),m("div",{style:{whiteSpace:"nowrap"}},e.name))}};var de={view({attrs:{workbench:r,path:e,alwaysShowNew:t}}){return m(ie(e.node.getAttr("view")||"list"),{workbench:r,path:e,alwaysShowNew:t})}},q={view({attrs:r,state:e,children:t}){let{path:n,workbench:o}=r,i=n.node,s=!1,l=i;i.refTo&&(s=!0,i=l.refTo);let d=!1;o.clipboard&&o.clipboard.op==="cut"&&o.clipboard.node.id===i.id&&(d=!0);let u=o.workspace.getExpanded(n.head,l),h=$(i,"handlePlaceholder")?oe(i,"handlePlaceholder"):"",p=a(c=>{e.hover=!0,c.stopPropagation()},"hover"),b=a(c=>{e.hover=!1,c.stopPropagation()},"unhover"),I=a(()=>{e.tagPopover&&(o.closePopover(),e.tagPopover=void 0)},"cancelTagPopover"),v=a(c=>{e.tagPopover?(e.tagPopover.oninput(c),c.target.value.includes("#")||I()):c.target.value.includes("#")&&(e.tagPopover={},A.showPopover(o,n,i,(S,k)=>{e.tagPopover={onkeydown:S,oninput:k}},I))},"oninput"),w=a(c=>{if(e.tagPopover){if(c.key==="Escape"){I();return}if(e.tagPopover.onkeydown(c)===!1)return c.stopPropagation(),!1}let S=c.shiftKey||c.metaKey||c.altKey||c.ctrlKey;switch(c.key){case"ArrowUp":c.target.selectionStart!==0&&!S&&c.stopPropagation();break;case"ArrowDown":c.target.selectionStart!==c.target.value.length&&c.target.selectionStart!==0&&!S&&c.stopPropagation();break;case"Backspace":if(c.target.value===""){if(c.preventDefault(),c.stopPropagation(),i.childCount>0)return;o.executeCommand("delete",{node:i,path:n,event:c});return}if(c.target.value!==""&&c.target.selectionStart===0&&c.target.selectionEnd===0){if(c.preventDefault(),c.stopPropagation(),i.childCount>0)return;let k=o.workspace.findAbove(n);if(!k)return;let y=k.node.name;k.node.name=y+c.target.value,i.destroy(),m.redraw.sync(),o.focus(k,y.length);return}break;case"Enter":if(c.preventDefault(),c.ctrlKey||c.shiftKey||c.metaKey||c.altKey)return;if(c.target.selectionStart===c.target.value.length){i.childCount>0&&o.workspace.getExpanded(n.head,i)?o.executeCommand("insert-child",{node:i,path:n},"",0):o.executeCommand("insert",{node:i,path:n}),c.stopPropagation();return}if(c.target.selectionStart===0){o.executeCommand("insert-before",{node:i,path:n}),c.stopPropagation();return}if(c.target.selectionStart>0&&c.target.selectionStart<c.target.value.length){o.executeCommand("insert",{node:i,path:n},c.target.value.slice(c.target.selectionStart)).then(()=>{i.name=c.target.value.slice(0,c.target.selectionStart)}),c.stopPropagation();return}break}},"onkeydown"),f=a(c=>{c.preventDefault(),c.stopPropagation(),o.executeCommand("zoom",{node:i,path:n}),document.selection&&document.selection.empty?document.selection.empty():window.getSelection&&window.getSelection().removeAllRanges()},"open"),x=a(c=>{if(i.hasComponent(C)){f(c);return}u?o.executeCommand("collapse",{node:l,path:n}):o.executeCommand("expand",{node:l,path:n}),c.stopPropagation()},"toggle"),g=a(c=>c.childCount+c.getLinked("Fields").length,"subCount"),F=a(()=>{if(i.id===o.context?.node?.id||e.hover||i.name.length>0||h.length>0)return!0},"showHandle");return m("div",{onmouseover:p,onmouseout:b,id:`node-${n.id}-${l.id}`,class:d?"cut-node":""},m("div",{class:"node-row-outer-wrapper flex flex-row items-start"},m("svg",{class:"node-menu shrink-0",xmlns:"http://www.w3.org/2000/svg",onclick:c=>o.showMenu(c,{node:l,path:n}),oncontextmenu:c=>o.showMenu(c,{node:l,path:n}),"data-menu":"node",viewBox:"0 0 16 16"},e.hover&&m("path",{style:{transform:"translateY(-1px)"},fill:"currentColor","fill-rule":"evenodd",d:"M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5z"})),m("div",{class:"node-handle shrink-0",onclick:x,ondblclick:f,oncontextmenu:c=>o.showMenu(c,{node:l,path:n}),"data-menu":"node",style:{display:F()?"block":"none"}},$(i,"handleIcon")?oe(i,"handleIcon",g(i)>0&&!u):m("svg",{class:"node-bullet",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg"},g(i)>0&&!u?m("circle",{id:"node-collapsed-handle",cx:"8",cy:"8",r:"8"}):null,m("circle",{cx:"8",cy:"8",r:"3",fill:"currentColor"}),",",s?m("circle",{id:"node-reference-handle",cx:"8",cy:"8",r:"7",fill:"none","stroke-width":"1",stroke:"currentColor","stroke-dasharray":"3,3"}):null)),i.raw.Rel==="Fields"?m("div",{class:"flex grow items-start flex-row"},m("div",null,m(W,{workbench:o,path:n,onkeydown:w,oninput:v})),m(W,{editValue:!0,workbench:o,path:n,onkeydown:w,oninput:v})):m("div",{class:"flex grow items-start flex-row",style:{gap:"0.5rem"}},$(i,"beforeEditor")&&se(i,"beforeEditor").map(c=>m(c.beforeEditor(),{node:i,component:c})),m(W,{workbench:o,path:n,onkeydown:w,oninput:v,placeholder:h}),$(i,"afterEditor")&&se(i,"afterEditor").map(c=>m(c.afterEditor(),{node:i,component:c})))),$(i,"belowEditor")&&se(i,"belowEditor").map(c=>m(c.belowEditor(),{node:i,component:c,expanded:u})),u===!0&&m("div",{class:"expanded-node flex flex-row"},m("div",{class:"indent flex",onclick:x}),m("div",{class:"view grow"},m(ie(i.getAttr("view")||"list"),{workbench:o,path:n}))))}};var Ae={view({attrs:{workbench:r,node:e}}){let t=new R(e,"quickadd");return m("div",{class:"notice"},m("h3",null,"Quick Add"),m(de,{workbench:r,path:t,alwaysShowNew:!0}),m("div",{class:"button-bar"},m("button",{class:"primary",onclick:()=>{r.commitQuickAdd(),r.closeDialog()}},"Add to Today")))}};var Pe={view({attrs:{workbench:r},state:e}){let t=r.workspace.settings.theme;return e.selectedTheme=e.selectedTheme===void 0?t:e.selectedTheme,m("div",{class:"notice"},m("h3",null,"Settings"),m("div",{class:"flex flex-row"},m("div",{class:"grow"},"Theme"),m("div",null,m("select",{name:"theme",oninput:a(o=>{e.selectedTheme=o.target.value},"oninput")},m("option",{selected:e.selectedTheme==="",value:""},"Light"),m("option",{selected:e.selectedTheme==="darkmode",value:"darkmode"},"Dark"),m("option",{selected:e.selectedTheme==="sepia",value:"sepia"},"Sepia"),m("option",{selected:e.selectedTheme==="sublime",value:"sublime"},"Sublime")))),m("div",{class:"button-bar"},m("button",{onclick:()=>{r.closeDialog()}},"Cancel"),m("button",{class:"primary",onclick:async o=>{t!==e.selectedTheme?(r.workspace.settings.theme=e.selectedTheme,await r.workspace.save(!0),location.reload()):r.closeDialog()}},"Save Changes")))}};var Te={view(){return m("div",{class:"notice"},m("h3",null,"Refresh to view latest updates"),m("p",null,"Your notes were updated in another browser session. Refresh the page to view the latest version."),m("div",{class:"button-bar"},m("button",{class:"primary",onclick:()=>{location.reload()}},"Refresh Now")))}},Fe={view({attrs:{workbench:r}}){return m("div",{class:"notice"},m("h3",null,"Treehouse is under active development"),m("p",null,"This is a preview based on our main branch, which is actively being developed."),m("p",null,"If you find a bug, please report it via \xA0",m("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 14",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-menu"},m("line",{x1:"3",y1:"12",x2:"21",y2:"12"}),m("line",{x1:"3",y1:"6",x2:"21",y2:"6"}),m("line",{x1:"3",y1:"18",x2:"21",y2:"18"})),"\xA0> ",m("strong",null,"Submit Issue"),"."),m("p",null,"Data is stored using localstorage, which you can reset via \xA0",m("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 14",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-menu"},m("line",{x1:"3",y1:"12",x2:"21",y2:"12"}),m("line",{x1:"3",y1:"6",x2:"21",y2:"6"}),m("line",{x1:"3",y1:"18",x2:"21",y2:"18"})),"\xA0> ",m("strong",null,"Reset Demo"),"."),m("div",{class:"button-bar"},m("button",{class:"primary",onclick:()=>{localStorage.setItem("firsttime","1"),r.closeDialog()}},"Got it")))}},Be={view({attrs:{workbench:r,finished:e}}){return m("div",{class:"notice"},m("h3",null,"Login with GitHub"),m("p",null,"The GitHub backend is experimental so use at your own risk!"),m("p",null,"To store your workbench we will create a public repository called ",m("pre",{style:{display:"inline"}},"<username>.treehouse.sh")," if it doesn't already exist. You can manually make this repository private via GitHub if you want."),m("p",null,"You can Logout via the \xA0",m("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 14",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-menu"},m("line",{x1:"3",y1:"12",x2:"21",y2:"12"}),m("line",{x1:"3",y1:"6",x2:"21",y2:"6"}),m("line",{x1:"3",y1:"18",x2:"21",y2:"18"})),"\xA0 menu in the top right to return to the localstorage backend."),m("div",{class:"button-bar"},m("button",{onclick:()=>{r.closeDialog()}},"Cancel"),m("button",{class:"primary",onclick:()=>{r.closeDialog(),localStorage.setItem("github","1"),e()}},"Log in with GitHub")))}};var G=class{constructor(e){this.commands=new te,this.keybindings=new ee,this.menus=new ne,this.backend=e,this.workspace=new _(e.files),this.context={node:null},this.panels=[],this.drawer={open:!1},this.dialog={body:()=>null},this.menu={body:()=>null}}get mainPanel(){return this.panels[0]}async initialize(){if(await this.workspace.load(),this.workspace.rawNodes.forEach(e=>this.backend.index.index(e)),this.workspace.observe(e=>{this.workspace.save(),e.isDestroyed?this.backend.index.remove(e.id):(this.backend.index.index(e.raw),e.components.forEach(t=>this.backend.index.index(t.raw)))}),this.workspace.lastOpenedID?this.openNewPanel(this.workspace.find(this.workspace.lastOpenedID)||this.workspace.mainNode()):this.openNewPanel(this.workspace.mainNode()),this.backend.loadExtensions&&await this.backend.loadExtensions(),this.workspace.settings.theme){let e=document.createElement("link");e.setAttribute("href",`https://treehouse.sh/style/themes/${this.workspace.settings.theme}.css`),e.setAttribute("rel","stylesheet"),e.setAttribute("type","text/css"),document.head.appendChild(e)}m.redraw()}authenticated(){return this.backend.auth&&this.backend.auth.currentUser()}openQuickAdd(){let e=this.workspace.find("@quickadd");e||(e=this.workspace.new("@quickadd")),this.showDialog(()=>m(Ae,{workbench:this,node:e}),!0),setTimeout(()=>{document.querySelector("main > dialog .new-node input").focus()},1)}commitQuickAdd(){let e=this.workspace.find("@quickadd");if(!e)return;let t=this.todayNode();e.children.forEach(n=>n.parent=t)}clearQuickAdd(){let e=this.workspace.find("@quickadd");e&&e.children.forEach(t=>t.destroy())}todayNode(){let e=new Date,t=e.toUTCString().split(e.getFullYear())[0],n=`Week ${String(Je(e)).padStart(2,"0")}`,i=["@calendar",`${e.getFullYear()}`,n,t].join("/"),s=this.workspace.find(i);return s||(s=this.workspace.new(i)),s}openToday(){this.open(this.todayNode())}open(e){this.workspace.expanded[e.id]||(this.workspace.expanded[e.id]={}),this.workspace.lastOpenedID=e.id,this.workspace.save();let t=new R(e);this.panels[0]=t,this.context.path=t}openNewPanel(e){this.workspace.expanded[e.id]||(this.workspace.expanded[e.id]={}),this.workspace.lastOpenedID=e.id,this.workspace.save();let t=new R(e);this.panels.push(t),this.context.path=t}closePanel(e){this.panels=this.panels.filter(t=>t.name!==e.name)}defocus(){let e=this.getInput(this.context.path);e&&e.blur(),this.context.node=null,this.context.path=null}focus(e,t=0){let n=this.getInput(e);n?(this.context.path=e,n.focus(),t!==void 0&&n.setSelectionRange(t,t)):console.warn("unable to find input for",e)}getInput(e){let t=`input-${e.id}-${e.node.id}`;e.node.raw.Rel==="Fields"&&e.node.name!==""&&(t=t+"-value");let n=document.getElementById(t);return n.editor?n.editor:n}canExecuteCommand(e,t,...n){return t=this.newContext(t),this.commands.canExecuteCommand(e,t,...n)}executeCommand(e,t,...n){return t=this.newContext(t),console.log(e,t,...n),this.commands.executeCommand(e,t,...n)}newContext(e){return Object.assign({},this.context,e)}showMenu(e,t,n){e.stopPropagation(),e.preventDefault();let o=e.target.closest("*[data-menu]"),i=o.getBoundingClientRect();if(!n){let d=o.dataset.align||"left";n={top:`${document.body.scrollTop+i.y+i.height}px`},d==="right"?(n.marginLeft="auto",n.marginRight=`${document.body.offsetWidth-i.right}px`):(n.marginLeft=`${document.body.scrollLeft+i.x}px`,n.marginRight="auto")}let s=this.menus.menus[o.dataset.menu],l=s.filter(d=>d.command).map(d=>this.commands.commands[d.command]);s&&(this.menu={body:()=>m(ye,{workbench:this,ctx:this.newContext(t),items:s,commands:l}),style:n},m.redraw(),setTimeout(()=>{document.querySelector("main > dialog.menu").showModal()},0))}closeMenu(){document.querySelector("main > dialog.menu").close(),workbench.menu.body=()=>null}showPalette(e,t,n){this.showDialog(()=>m(be,{workbench:this,ctx:n}),!1,{left:`${e}px`,top:`${t}px`})}showNotice(e,t){this.showDialog(()=>m({firsttime:Fe,github:Be,lockstolen:Te}[e],{workbench:this,finished:t}),!0,void 0,e==="lockstolen")}toggleDrawer(){this.drawer.open=!this.drawer.open,m.redraw()}showSettings(){this.showDialog(()=>m(Pe,{workbench:this}),!0)}showPopover(e,t){this.popover={body:e,style:t},m.redraw()}closePopover(){this.popover=null,m.redraw()}showDialog(e,t,n,o){this.dialog={body:e,backdrop:t,style:n,explicitClose:o},m.redraw(),setTimeout(()=>{document.querySelector("main > dialog.modal").showModal()},0)}isDialogOpen(){return document.querySelector("main > dialog.modal").hasAttribute("open")}closeDialog(){document.querySelector("main > dialog.modal").close(),this.dialog.body=()=>null}search(e){if(!e)return[];let t=e.split(/\s+(?=(?:[^\'"]*[\'"][^\'"]*[\'"])*[^\'"]*$)/),n=t.filter(l=>!l.includes(":")).join(" "),o=Object.fromEntries(t.filter(l=>l.includes(":")).map(l=>l.toLowerCase().split(":")));!n&&Object.keys(o).length>0&&(n=Object.keys(o)[0]);let i=a(l=>{if(Object.keys(o).length>0){let d={};for(let u of l.getLinked("Fields"))d[u.name.toLowerCase()]=u.value.toLowerCase();for(let u in o){let h=d[u.replace(/['"]/g,"")];if(!h||h!==o[u].replace(/['"]/g,""))return!1}}return!0},"passFieldQuery");if(n.startsWith("#"))return A.findTagged(this.workspace,n.replace("#","")).filter(i);let s={};return this.backend.index.search(n).forEach(l=>{let d=window.workbench.workspace.find(l);d&&(d.value&&(d=d.parent,!d.raw)||i(d)&&(s[d.id]=d))}),Object.values(s)}};a(G,"Workbench");function Je(r){var e=new Date(Date.UTC(r.getFullYear(),r.getMonth(),r.getDate())),t=e.getUTCDay()||7;e.setUTCDate(e.getUTCDate()+4-t);var n=new Date(Date.UTC(e.getUTCFullYear(),0,1));return Math.ceil(((e-n)/864e5+1)/7)}a(Je,"getWeekOfYear");function Re(r){function e(k,y){var D=k<<y|k>>>32-y;return D}a(e,"rotate_left");function t(k){var y="",D,B,fe;for(D=0;D<=6;D+=2)B=k>>>D*4+4&15,fe=k>>>D*4&15,y+=B.toString(16)+fe.toString(16);return y}a(t,"lsb_hex");function n(k){var y="",D,B;for(D=7;D>=0;D--)B=k>>>D*4&15,y+=B.toString(16);return y}a(n,"cvt_hex");function o(k){k=k.replace(/\r\n/g,`
`);for(var y="",D=0;D<k.length;D++){var B=k.charCodeAt(D);B<128?y+=String.fromCharCode(B):B>127&&B<2048?(y+=String.fromCharCode(B>>6|192),y+=String.fromCharCode(B&63|128)):(y+=String.fromCharCode(B>>12|224),y+=String.fromCharCode(B>>6&63|128),y+=String.fromCharCode(B&63|128))}return y}a(o,"Utf8Encode");var i,s,l,d=new Array(80),u=1732584193,h=4023233417,p=2562383102,b=271733878,I=3285377520,v,w,f,x,g,S;r=o(r);var F=r.length,c=new Array;for(s=0;s<F-3;s+=4)l=r.charCodeAt(s)<<24|r.charCodeAt(s+1)<<16|r.charCodeAt(s+2)<<8|r.charCodeAt(s+3),c.push(l);switch(F%4){case 0:s=2147483648;break;case 1:s=r.charCodeAt(F-1)<<24|8388608;break;case 2:s=r.charCodeAt(F-2)<<24|r.charCodeAt(F-1)<<16|32768;break;case 3:s=r.charCodeAt(F-3)<<24|r.charCodeAt(F-2)<<16|r.charCodeAt(F-1)<<8|128;break}for(c.push(s);c.length%16!=14;)c.push(0);for(c.push(F>>>29),c.push(F<<3&4294967295),i=0;i<c.length;i+=16){for(s=0;s<16;s++)d[s]=c[i+s];for(s=16;s<=79;s++)d[s]=e(d[s-3]^d[s-8]^d[s-14]^d[s-16],1);for(v=u,w=h,f=p,x=b,g=I,s=0;s<=19;s++)S=e(v,5)+(w&f|~w&x)+g+d[s]+1518500249&4294967295,g=x,x=f,f=e(w,30),w=v,v=S;for(s=20;s<=39;s++)S=e(v,5)+(w^f^x)+g+d[s]+1859775393&4294967295,g=x,x=f,f=e(w,30),w=v,v=S;for(s=40;s<=59;s++)S=e(v,5)+(w&f|w&x|f&x)+g+d[s]+2400959708&4294967295,g=x,x=f,f=e(w,30),w=v,v=S;for(s=60;s<=79;s++)S=e(v,5)+(w^f^x)+g+d[s]+3395469782&4294967295,g=x,x=f,f=e(w,30),w=v,v=S;u=u+v&4294967295,h=h+w&4294967295,p=p+f&4294967295,b=b+x&4294967295,I=I+g&4294967295}var S=n(u)+n(h)+n(p)+n(b)+n(I);return S.toLowerCase()}a(Re,"SHA1");var R=class{constructor(e,t){t?this.name=t:this.name=Math.random().toString(36).substring(2),e?this.nodes=[e]:this.nodes=[]}push(e){this.nodes.push(e)}pop(){return this.nodes.pop()||null}sub(){return new R(this.node,this.name)}clone(){let e=new R;return e.name=this.name,e.nodes=[...this.nodes],e}append(e){let t=this.clone();return t.push(e),t}get length(){return this.nodes.length}get id(){return Re([this.name,...this.nodes.map(e=>e.id)].join(":"))}get node(){return this.nodes[this.nodes.length-1]}get previous(){return this.nodes.length<2?null:this.nodes[this.nodes.length-2]}get head(){return this.nodes[0]}};a(R,"Path");var X=class{constructor(){this.nodes={"@root":{ID:"@root",Name:"@root",Linked:{Children:[],Components:[]},Attrs:{}}},this.observers=[]}changed(e){this.observers.forEach(t=>t(e))}import(e){for(let t of e)t.Value&&Y(t.Name)&&(t.Value=xe(t.Name,t.Value),t.Rel="Components"),this.nodes[t.ID]=t;for(let t of e){if(t.Parent==="@tmp"){delete this.nodes[t.ID];continue}if(!t.ID.startsWith("@")&&t.Parent===void 0){delete this.nodes[t.ID];continue}if(t.Parent&&!this.nodes[t.Parent]){delete this.nodes[t.ID];continue}let n=this.find(t.ID);if(n){if(n.parent&&!n.parent.raw){delete this.nodes[t.ID];continue}V(n,"onAttach",n)}}}export(){let e=[];for(let t of Object.values(this.nodes))e.push(t);return e}make(e,t){let n=null;if(e.includes("/")){let s=e.split("/");n=this.find(s[0]);for(let l=1;l<s.length-1;l++){if(n===null)throw"unable to get root";let d=n.find(s[l]);d||(d=this.make(s.slice(0,l+1).join("/"))),n=d}e=s[s.length-1]}let o=e.startsWith("@")?e:Ye();this.nodes[o]={ID:o,Name:e,Value:t,Linked:{Children:[],Components:[]},Attrs:{}};let i=new P(this,o);return n&&(i.parent=n),i}destroy(e){let t=e.parent;if(t!==null&&!t.isDestroyed){let n=e.raw.Rel||"Children";t.raw.Linked[n].includes(e.id)&&t.raw.Linked[n].splice(e.siblingIndex,1)}delete this.nodes[e.id],t&&this.changed(t)}roots(){return Object.values(this.nodes).filter(e=>e.Parent===void 0).map(e=>new P(this,e.ID))}root(e){e=e||"@root";let t=this.roots().find(n=>n.name===e);return t===void 0?null:t}find(e){let t=this.nodes[e];if(t)return new P(this,t.ID);let n=e.split("/");if(n.length===1&&n[0].startsWith("@"))return null;let o=this.root(n[0]);if(!o&&this.nodes[n[0]]&&(o=new P(this,this.nodes[n[0]].ID)),o?n.shift():o=this.root("@root"),!o)return null;let i=a((s,l)=>(s.refTo&&(s=s.refTo),s.children.find(d=>d.name===l)),"findChild");for(let s of n){let l=i(o,s);if(!l)return null;o=l}return o}walk(e,t){for(let n of this.roots())if(n.walk(e,t))return}observe(e){this.observers.push(e)}};a(X,"Bus");var Ye=a(()=>{let r=Date.now().toString(36),e=Math.random().toString(36).substring(2);return r+e},"uniqueId");var P=class{constructor(e,t){this._bus=e,this._id=t}[Symbol.for("Deno.customInspect")](){return`Node[${this.id}:${this.name}]`}get id(){return this._id}get bus(){return this._bus}get raw(){let e=this._bus.nodes[this.id];if(!e)throw`use of non-existent node ${this.id}`;return e}get name(){return this.refTo?this.refTo.name:this.raw.Name}set name(e){this.refTo?this.refTo.name=e:this.raw.Name=e,this.changed()}get value(){return this.refTo?this.refTo.value:this.raw.Value}set value(e){this.refTo?this.refTo.value=e:this.raw.Value=e,this.changed()}get parent(){return!this.raw.Parent||!this._bus.nodes[this.raw.Parent]?null:new P(this._bus,this.raw.Parent)}set parent(e){let t=this.parent;t!==null&&t.raw.Linked.Children.splice(this.siblingIndex,1),e!==null?(this.raw.Parent=e.id,e.raw.Linked.Children.push(this.id),V(e,"onAttach",e)):this.raw.Parent=void 0,this.changed()}get refTo(){let e=this.raw.Attrs.refTo;return!e||!this._bus.nodes[e]?null:new P(this._bus,e)}set refTo(e){if(!e){delete this.raw.Attrs.refTo,this.changed();return}this.raw.Attrs.refTo=e.id,this.changed()}get siblingIndex(){let e=this.parent;if(e===null)return 0;let t=this.raw.Rel||"Children";return e.raw.Linked[t].findIndex(n=>n===this.id)}set siblingIndex(e){let t=this.parent;if(t===null)return;let n=this.raw.Rel||"Children";t.raw.Linked[n].splice(this.siblingIndex,1),t.raw.Linked[n].splice(e,0,this.id),t.changed()}get prevSibling(){let e=this.parent;if(e===null||this.siblingIndex===0)return null;let t=this.raw.Rel||"Children";return e.getLinked(t)[this.siblingIndex-1]}get nextSibling(){let e=this.parent;if(e===null||this.siblingIndex===e.children.length-1)return null;let t=this.raw.Rel||"Children";return e.getLinked(t)[this.siblingIndex+1]}get ancestors(){let e=[],t=this.parent;for(;t!==null;)e.push(t),t=t.parent;return e}get isDestroyed(){return!this._bus.nodes.hasOwnProperty(this.id)}get path(){let e=this,t=[];for(;e;)t.unshift(e.name),e=e.parent;return t.join("/")}get children(){if(this.refTo)return this.refTo.children;let e=[];this.raw.Linked.Children&&(e=this.raw.Linked.Children.map(t=>new P(this._bus,t)));for(let t of this.components)if(z(t,"objectChildren"))return V(t,"objectChildren",this,e);return e}get childCount(){if(this.refTo)return this.refTo.childCount;for(let e of this.components)if(z(e,"objectChildren"))return V(e,"objectChildren",this,null).length;return this.raw.Linked.Children?this.raw.Linked.Children.length:0}addChild(e){if(this.refTo){this.refTo.addChild(e);return}this.raw.Linked.Children.push(e.id),this.changed()}removeChild(e){if(this.refTo){this.refTo.removeChild(e);return}let t=this.raw.Linked.Children.filter(n=>n===e.id);this.raw.Linked.Children=t,this.changed()}get fields(){return this.raw.Linked.Fields?this.raw.Linked.Fields.map(e=>new P(this._bus,e)):[]}get fieldCount(){return this.raw.Linked.Fields?this.raw.Linked.Fields.length:0}get components(){return this.raw.Linked.Components?this.raw.Linked.Components.map(e=>new P(this._bus,e)):[]}get componentCount(){return this.raw.Linked.Components?this.raw.Linked.Components.length:0}addComponent(e){let t=this.bus.make(Q(e),e);t.raw.Parent=this.id,t.raw.Rel="Components",this.raw.Linked.Components.push(t.id),V(t,"onAttach",t),this.changed()}removeComponent(e){let t;e.name&&Y(e)?t=this.components.filter(n=>n.name===Q(e)):t=this.components.filter(n=>n.value===e),t.length>0&&t[0].destroy(),this.changed()}hasComponent(e){return this.components.filter(n=>n.name===Q(e)).length>0}getComponent(e){let t=this.components.filter(n=>n.name===Q(e));return t.length>0?t[0].value:null}getLinked(e){return this.raw.Linked[e]?this.raw.Linked[e].map(t=>new P(this._bus,t)):[]}addLinked(e,t){this.raw.Linked[e]||(this.raw.Linked[e]=[]),t.raw.Rel=e,this.raw.Linked[e].push(t.id),this.changed()}removeLinked(e,t){this.raw.Linked[e]||(this.raw.Linked[e]=[]);let n=this.raw.Linked[e].filter(o=>o===t.id);this.raw.Linked[e]=n,this.changed()}moveLinked(e,t,n){this.raw.Linked[e]||(this.raw.Linked[e]=[]);let o=this.raw.Linked[e].findIndex(s=>s===t.id);if(o===-1)return;let i=this.raw.Linked[e];i.splice(n,0,i.splice(o,1)[0]),this.raw.Linked[e]=i,this.changed()}getAttr(e){return this.raw.Attrs[e]||""}setAttr(e,t){this.raw.Attrs[e]=t,this.changed()}find(e){return this.bus.find([this.path,e].join("/"))}walk(e,t){if(t=t||{followRefs:!1,includeComponents:!1},e(this))return!0;let n=this.children;if(this.refTo&&t.followRefs){if(e(this.refTo))return!0;n=this.refTo.children}for(let o of n)if(o.walk(e,t))return!0;if(t.includeComponents){for(let o of this.components)if(o.walk(e,t))return!0}return!1}destroy(){if(this.isDestroyed)return;if(this.refTo){this._bus.destroy(this);return}let e=[];this.walk(t=>(e.push(t),!1),{followRefs:!1,includeComponents:!0}),e.reverse().forEach(t=>this._bus.destroy(t))}duplicate(){let e=this._bus.make(this.name,Ce(this.value));return e.raw.Rel=this.raw.Rel,this.fields.map(t=>t.duplicate()).forEach(t=>{e.addLinked("Fields",t),t.raw.Parent=e.raw.ID}),this.components.map(t=>t.duplicate()).forEach(t=>{e.addLinked("Components",t),t.raw.Parent=e.raw.ID}),this.children.map(t=>t.duplicate()).forEach(t=>{e.addChild(t),t.raw.Parent=e.raw.ID}),e}changed(){this._bus.changed(this)}};a(P,"Node");var _=class{constructor(e){this.fs=e,this.bus=new X,this.expanded={},this.settings={},this.writeDebounce=_e(async(t,n)=>{try{await this.fs.writeFile(t,n),console.log("Saved workspace.")}catch(o){console.error(o),document.dispatchEvent(new CustomEvent("BackendError"))}})}get rawNodes(){return this.bus.export()}observe(e){this.bus.observe(e)}async save(e){let t=JSON.stringify({version:1,lastopen:this.lastOpenedID,expanded:this.expanded,nodes:this.rawNodes,settings:this.settings},null,2);e?await this.fs.writeFile("workspace.json",t):this.writeDebounce("workspace.json",t)}async load(){let e=JSON.parse(await this.fs.readFile("workspace.json")||"{}");if(e.nodes&&(e.nodes=e.nodes.map(t=>(t.Name==="treehouse.SearchNode"&&(t.Name="treehouse.SmartNode"),t)),this.bus.import(e.nodes),console.log(`Loaded ${e.nodes.length} nodes.`)),e.expanded)for(let t in e.expanded)for(let n in e.expanded[t])this.bus.find(n)&&(this.expanded[t]||(this.expanded[t]={}),this.expanded[t][n]=e.expanded[t][n]);e.lastopen&&(this.lastOpenedID=e.lastopen),e.settings&&(this.settings=Object.assign(this.settings,e.settings))}mainNode(){let e=this.bus.find("@workspace");if(!e){console.info("Building missing workspace node.");let t=this.bus.find("@root"),n=this.bus.make("@workspace");n.name="Workspace",n.parent=t;let o=this.bus.make("@calendar");o.name="Calendar",o.parent=n;let i=this.bus.make("Home");i.parent=n,e=n}return e}find(e){return this.bus.find(e)}new(e,t){return this.bus.make(e,t)}getExpanded(e,t){this.expanded[e.id]||(this.expanded[e.id]={});let n=this.expanded[e.id][t.id];return n===void 0&&(n=!1),n}setExpanded(e,t,n){this.expanded[e.id]||(this.expanded[e.id]={}),this.expanded[e.id][t.id]=n,this.save()}findAbove(e){if(e.node.id===e.head.id)return null;let t=e.clone();t.pop();let n=e.node.prevSibling;if(!n){let i=e.previous.getLinked("Fields").length;return e.node.raw.Rel!=="Fields"&&i>0?t.append(e.previous.getLinked("Fields")[i-1]):t}let o=a(i=>{if(!this.getExpanded(e.head,i.node))return i;let l=i.node.getLinked("Fields").length;if(i.node.childCount===0&&l>0){let u=i.node.getLinked("Fields")[l-1];return o(i.append(u))}if(i.node.childCount===0)return i;let d=i.node.children[i.node.childCount-1];return o(i.append(d))},"lastSubIfExpanded");return o(t.append(n))}findBelow(e){let t=e.clone();if(this.getExpanded(e.head,e.node)&&e.node.getLinked("Fields").length>0)return t.append(e.node.getLinked("Fields")[0]);if(this.getExpanded(e.head,e.node)&&e.node.childCount>0)return t.append(e.node.children[0]);let n=a(o=>{let i=o.node.nextSibling;if(i)return o.pop(),o.append(i);let s=o.previous;return s?o.node.raw.Rel==="Fields"&&s.childCount>0?(o.pop(),o.append(s.children[0])):(o.pop(),n(o)):null},"nextSiblingOrParentNextSibling");return n(t)}};a(_,"Workspace");function _e(r,e=3e3){let t;return(...n)=>{clearTimeout(t),t=setTimeout(()=>{r.apply(this,n)},e)}}a(_e,"debounce");var je={view({attrs:r,children:e}){let t=r.open;return m("div",{class:`drawer ${t?"open":"closed"}`},e)}};var j=class{constructor(){this.markdown=""}};a(j,"Page"),j=L([E],j);var Me={view({attrs:r}){let e=r.path,t=r.workbench,n=e.node,o=a(h=>{t.executeCommand("close-panel",{},e)},"close"),i=a(h=>{e.pop()===e.node&&e.pop()},"goBack"),s=a(h=>{t.panels=[e],t.context.path=e},"maximize"),l=a(h=>{n.getComponent(j).markdown=h.target.value,n.changed()},"editMarkdown");function d(h=""){return 20+(h.match(/\n/g)||[]).length*20}a(d,"calcHeight");let u="";return n.getAttr("view")&&(u=`${n.getAttr("view")}-panel`),m("div",{class:`panel flex flex-col grow ${u}`},m("div",{class:"bar flex"},e.length>1?m("div",{class:"panel-back",style:{rightPadding:"var(--padding)"}},m("svg",{onclick:i,xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"},m("path",{"fill-rule":"evenodd",d:"M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8z"}))):null,m("div",{class:"panel-back-parent grow"},n.parent&&n.parent.id!=="@root"?m("span",{style:{cursor:"pointer"},onclick:()=>t.open(n.parent)},n.parent.name):m("span",null,"\xA0")),t.panels.length>1?m("div",{class:"panel-icons flex items-center"},m("svg",{onclick:s,style:{cursor:"pointer"},xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-maximize-2"},m("polyline",{points:"15 3 21 3 21 9"}),m("polyline",{points:"9 21 3 21 3 15"}),m("line",{x1:"21",y1:"3",x2:"14",y2:"10"}),m("line",{x1:"3",y1:"21",x2:"10",y2:"14"})),m("svg",{onclick:o,style:{cursor:"pointer"},xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-x"},m("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),m("line",{x1:"6",y1:"6",x2:"18",y2:"18"}))):null),m("div",{class:"body flex flex-col"},m("div",{class:"title-node",oncontextmenu:h=>t.showMenu(h,{node:n,path:e}),"data-menu":"node"},m(W,{workbench:t,path:e,disallowEmpty:!0})),n.hasComponent(j)?m("textarea",{oninput:l,value:n.getComponent(j).markdown,placeholder:"Enter Markdown text here",style:{marginLeft:"var(--padding)",padding:"var(--padding)",outline:"0",height:`${d(n.getComponent(j).markdown)}px`,border:"0"}},n.getComponent(j).markdown):null,m(de,{workbench:t,path:e.sub(),alwaysShowNew:!0})))}};var Oe={view({attrs:r}){let e=r.workbench,t={"":["pick-command"],Edit:["cut","copy","copy-reference","paste","mark-done","insert","delete"],Navigate:["expand","collapse","indent","outdent","move-up","move-down","prev","next"]},n=a(o=>{let i=e.keybindings.getBinding(o.id);return i?K(i.key).join(" ").toUpperCase():""},"getBindingSymbols");return m("div",{class:"reference"},m("h2",null,"Keyboard Shortcuts"),Object.entries(t).map(([o,i])=>m("div",null,o.length!==0&&m("h3",null,o),m("div",null,i.map(s=>e.commands.commands[s]).map(s=>m("div",{class:"flex item"},m("div",{class:"keybindings text-left"},n(s)),m("div",{class:"grow"},s.title)))))))}};var me={view({attrs:{input:r,workbench:e}}){return m("div",{class:"search"},m(J,{onpick:a(o=>{e.closeDialog(),e.open(o)},"onpick"),onchange:a(o=>{o.input?o.items=e.search(o.input):o.items=[]},"onchange"),input:r,inputview:(o,i,s)=>m("div",{class:"flex items-center"},m("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-search shrink-0 items-center"},m("circle",{cx:"11",cy:"11",r:"8"}),m("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})),m("input",{type:"text",placeholder:"Search",value:s,onkeydown:o,oninput:i})),itemview:o=>m("div",null,o.name)}))}};var He={view({attrs:{workbench:r},state:e}){e.open=e.open===void 0?!0:e.open;let t=a(n=>{e.open?e.open=!1:e.open=!0},"toggle");return m("main",{class:"workbench m-0 flex flex-row absolute inset-0",style:{overflow:"none"}},m("div",{class:"sidebar flex flex-col",style:{width:e.open?"256px":"52px"}},m("div",{class:"sidebar-top",style:{height:"56px"}},m("div",{class:"logo"})),m("div",{class:"grow sidebar-main"},e.open&&r.workspace.bus.root().children.map(n=>m($e,{node:n,expanded:!0,level:0,workbench:r}))),m("div",{class:"sidebar-bottom"},m("svg",{onclick:t,xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-sidebar"},m("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),m("line",{x1:"9",y1:"3",x2:"9",y2:"21"})))),m("div",{class:"main flex flex-col grow"},m("div",{class:"topbar flex"},m("div",{class:"topbar-item",onclick:()=>r.openToday(),style:{cursor:"pointer",marginLeft:"var(--padding)",marginRight:"var(--padding)",display:"flex",alignItems:"center"}},m("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-calendar"},m("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),m("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),m("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),m("line",{x1:"3",y1:"10",x2:"21",y2:"10"})),m("div",null,"Today")),m("div",{class:"topbar-item",onclick:()=>r.openQuickAdd(),style:{cursor:"pointer",marginLeft:"var(--padding)",marginRight:"var(--padding)",display:"flex",alignItems:"center"}},m("svg",{style:{marginRight:"var(--1)"},xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-plus-circle"},m("circle",{cx:"12",cy:"12",r:"10"}),m("line",{x1:"12",y1:"8",x2:"12",y2:"16"}),m("line",{x1:"8",y1:"12",x2:"16",y2:"12"})),m("div",null,"Quick Add")),m("div",{class:"searchbar flex grow"},m("div",null,m("div",{class:"flex",style:{margin:"1px"}},m("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-search shrink-0"},m("circle",{cx:"11",cy:"11",r:"8"}),m("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})),m("input",{type:"text",placeholder:"Search",onkeydown:n=>{if(n.key==="Control"||n.key==="Alt"||n.key==="Shift"||n.key==="Meta")return;let o=n.target.getBoundingClientRect();r.showDialog(()=>m(me,{workbench:r,input:n.key}),!1,{left:`${o.left-33}px`,top:`${o.top-9}px`,width:`${o.width+33}px`}),n.preventDefault()},style:{border:"0",outline:"0",background:"transparent",paddingTop:"3px"}})))),m("div",{onclick:()=>r.toggleDrawer(),"data-menu":"keyboard-reference","data-align":"right",style:{cursor:"pointer",marginLeft:"var(--padding)",marginRight:"var(--padding)",marginTop:"-2px"}},m("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},m("g",{"clip-path":"url(#clip0_442_8012)"},m("path",{d:"M20 6H4C2.89543 6 2 6.76751 2 7.71429V16.2857C2 17.2325 2.89543 18 4 18H20C21.1046 18 22 17.2325 22 16.2857V7.71429C22 6.76751 21.1046 6 20 6Z",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"}),m("path",{d:"M6 10H6.01",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"}),m("path",{d:"M7.5 12H7.51",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"}),m("path",{d:"M10.5 12H10.51",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"}),m("path",{d:"M13.5 12H13.51",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"}),m("path",{d:"M16.5 12H16.51",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"}),m("path",{d:"M9 10H9.01",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"}),m("path",{d:"M12 10H12.01",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"}),m("path",{d:"M15 10H15.01",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"}),m("path",{d:"M18 10H18.01",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"}),m("path",{d:"M5 15H19",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"})),m("defs",null,m("clipPath",{id:"clip0_442_8012"},m("rect",{width:"22",height:"14",fill:"white",transform:"translate(1 5)"}))))),m("div",{onclick:n=>r.showMenu(n),"data-menu":"settings","data-align":"right",style:{cursor:"pointer",marginLeft:"var(--padding)",marginRight:"var(--padding)"}},m("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-menu"},m("line",{x1:"3",y1:"12",x2:"21",y2:"12"}),m("line",{x1:"3",y1:"6",x2:"21",y2:"6"}),m("line",{x1:"3",y1:"18",x2:"21",y2:"18"})))),m("div",{class:"panels flex flex-row grow",style:{position:"relative",overflow:"hidden"}},r.panels.map(n=>m("div",null,m(Me,{workbench:r,path:n}))),m(je,{open:r.drawer.open},m(Oe,{workbench:r}))),m("div",{class:"mobile-nav flex-row"},m("div",null,m("svg",{onclick:()=>{let n=document.querySelector(".sidebar").style;n.display!=="flex"?n.display="flex":n.display="none"},xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-sidebar"},m("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),m("line",{x1:"9",y1:"3",x2:"9",y2:"21"}))),m("div",{onclick:()=>r.openToday()},m("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-calendar"},m("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),m("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),m("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),m("line",{x1:"3",y1:"10",x2:"21",y2:"10"}))),m("div",{onclick:()=>r.openQuickAdd()},m("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-plus-circle"},m("circle",{cx:"12",cy:"12",r:"10"}),m("line",{x1:"12",y1:"8",x2:"12",y2:"16"}),m("line",{x1:"8",y1:"12",x2:"16",y2:"12"}))),m("div",{onclick:()=>r.showDialog(()=>m(me,{workbench:r}),!0,{top:"25%",bottom:"100px"})},m("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-search shrink-0"},m("circle",{cx:"11",cy:"11",r:"8"}),m("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"}))),m("div",{onclick:n=>r.showMenu(n,void 0,{bottom:"100px",marginTop:"auto"}),"data-menu":"settings"},m("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-menu"},m("line",{x1:"3",y1:"12",x2:"21",y2:"12"}),m("line",{x1:"3",y1:"6",x2:"21",y2:"6"}),m("line",{x1:"3",y1:"18",x2:"21",y2:"18"}))))),r.popover&&m("div",{class:"popover",style:{position:"absolute",...r.popover.style}},r.popover.body()),m("dialog",{class:r.dialog.backdrop?"popover modal backdrop":"popover modal",style:r.dialog.style?{margin:"0",...r.dialog.style}:{top:"-50%"},oncancel:n=>{if(r.dialog.explicitClose===!0){n.preventDefault();return}r.dialog.body=()=>null},onclick:n=>{let i=n.target.closest("dialog").getBoundingClientRect(),s=n.clientX==0&&n.clientY==0;r.dialog.explicitClose!==!0&&(n.clientX<i.left||n.clientX>i.right||n.clientY<i.top||n.clientY>i.bottom)&&!s&&r.closeDialog()}},r.dialog.body()),m("dialog",{class:"menu popover",style:{margin:"0",...r.menu.style},oncancel:n=>{r.menu.body=()=>null},onclick:n=>{let i=n.target.closest("dialog").getBoundingClientRect();(n.clientX<i.left||n.clientX>i.right||n.clientY<i.top||n.clientY>i.bottom)&&r.closeMenu()}},r.menu.body()))}},$e={view({attrs:{node:r,workbench:e,expanded:t,level:n},state:o}){o.expanded=o.expanded===void 0?t:o.expanded;let i=r.childCount>0&&n<3,s=a(d=>{i&&(o.expanded?o.expanded=!1:o.expanded=!0,d.stopPropagation())},"toggle"),l=a(d=>{document.querySelector(".mobile-nav").offsetHeight&&(document.querySelector(".sidebar").style.display="none"),e.open(r)},"open");return m("div",null,m("div",{class:"sidebar-item flex"},m("svg",{onclick:s,class:"feather feather-chevron-right shrink-0",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",xmlns:"http://www.w3.org/2000/svg"},i?o.expanded?m("polyline",{points:"6 9 12 15 18 9"}):m("polyline",{points:"9 18 15 12 9 6"}):null),m("div",{class:"sidebar-item-label grow",onclick:l,style:{cursor:"pointer",maxWidth:"100%",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}},r.name)),o.expanded&&m("div",{class:"sidebar-item-nested"},r.children.filter(d=>d.name!=="").map(d=>m($e,{workbench:e,node:d,level:n+1}))))}};var T=class{constructor(){this.checked=!1}beforeEditor(){return Xe}};a(T,"Checkbox"),T=L([E],T);var Xe={view({attrs:{node:r}}){return m("input",{type:"checkbox",style:{marginTop:"0.3rem"},onclick:a(t=>{let n=r.getComponent(T);n.checked=!n.checked,r.changed()},"toggleCheckbox"),checked:r.getComponent(T).checked})}};var U=class{constructor(){}handleIcon(){return m("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},m("polyline",{points:"4 7 4 4 20 4 20 7"}),m("line",{x1:"9",y1:"20",x2:"15",y2:"20"}),m("line",{x1:"12",y1:"4",x2:"12",y2:"20"}))}};a(U,"TextField"),U=L([E],U);var N=class{constructor(){this.log=[],this.showLog=!1}onAttach(e){this.component=e,this.object=e.parent}fromJSON(e){e.startedAt&&(this.startedAt=new Date(e.startedAt)),this.log=(e.log||[]).map(t=>[new Date(t[0]),new Date(t[1])]),this.showLog=e.showLog}toJSON(e){return{startedAt:this.startedAt,log:this.log,showLog:this.showLog}}localTotal(){return this.log.map(this.entryDuration).reduce((e,t)=>e+t,0)}grandTotal(){let e=this.localTotal();return this.object&&this.object.children.forEach(t=>{t.hasComponent(N)&&(e+=t.getComponent(N).grandTotal())}),e}start(){this.startedAt||(this.startedAt=new Date)}stop(){if(!this.startedAt)return;let e=new Date;(e.getTime()-this.startedAt.getTime())/1e3>=60&&this.log.push([this.startedAt,e]),this.startedAt=void 0}formatEntry(e){return e.length!==2?"":`${this.formatDate(e[0])} - ${new Intl.DateTimeFormat("en",{timeStyle:"short"}).format(e[1])}`}entryDuration(e){let t=e[0];return((e[1]||new Date).getTime()-t.getTime())/1e3}formatDate(e){return e?new Intl.DateTimeFormat("en",{dateStyle:"short",timeStyle:"short"}).format(e):""}formatDuration(e){let t=e/60,n=Math.floor(t%60);return t=t/60,`${Math.floor(t%60)}:${n.toLocaleString("en-US",{minimumIntegerDigits:2,useGrouping:!1})}`}afterEditor(){return Ze}belowEditor(){return et}static initialize(e){e.commands.registerCommand({id:"stop-clock",title:"Stop clock",when:t=>!(!t.node||t.node.raw.Rel==="Fields"||t.node.parent&&t.node.parent.hasComponent(Document)),action:t=>{if(!t.node.hasComponent(N)){let n=new N;t.node.addComponent(n)}t.node.getComponent(N).stop(),t.node.changed()}}),e.keybindings.registerBinding({command:"stop-clock",key:"meta+o"}),e.commands.registerCommand({id:"start-clock",title:"Start clock",when:t=>!(!t.node||t.node.raw.Rel==="Fields"||t.node.parent&&t.node.parent.hasComponent(Document)),action:t=>{if(!t.node.hasComponent(N)){let n=new N;t.node.addComponent(n)}t.node.getComponent(N).start(),t.node.changed()}}),e.keybindings.registerBinding({command:"start-clock",key:"meta+i"}),e.commands.registerCommand({id:"remove-clock",title:"Remove clock",when:t=>!t.node||t.node.raw.Rel==="Fields"||t.node.parent&&t.node.parent.hasComponent(Document)?!1:!!t.node.hasComponent(N),action:t=>{t.node.removeComponent(N)}})}};a(N,"Clock"),N=L([E],N);var Ze={view({attrs:{node:r}}){let e=r.getComponent(N),t=a(()=>{e.showLog=!e.showLog,r.changed()},"toggleLog");return!e.showLog&&e.startedAt?m("div",{tabindex:"1",onclick:t,class:"badge flex flex-row items-center",style:{background:"green",lineHeight:"var(--body-line-height)",paddingLeft:"0.25rem",paddingRight:"0.25rem",borderRadius:"4px",color:"white"}},m("svg",{class:"blink",style:{width:"1rem",height:"1rem",marginRight:"0.25rem"},xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},m("circle",{cx:"12",cy:"12",r:"10"}),m("polyline",{points:"12 6 12 12 16 14"})),m("div",null,e.formatDuration(e.entryDuration([e.startedAt])))):m("div",{tabindex:"1",onclick:t,class:"badge flex flex-row items-center",style:{background:"gray",lineHeight:"var(--body-line-height)",paddingLeft:"0.25rem",paddingRight:"0.25rem",borderRadius:"4px",color:"white"}},m("svg",{style:{width:"1rem",height:"1rem",marginRight:"0.25rem"},xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},m("circle",{cx:"12",cy:"12",r:"10"}),m("polyline",{points:"12 6 12 12 16 14"})),m("div",null,e.formatDuration(e.grandTotal())))}},et={view({attrs:{node:r}}){let e=r.getComponent(N);if(e.showLog)return m("div",{class:"expanded-node flex flex-row"},m("div",{class:"indent flex"}),m("div",{class:"grow"},e.startedAt&&m("div",{class:"flex flex-row",style:{marginBottom:"2px"}},m("div",{class:"grow"},e.formatDate(e.startedAt)," - ..."),m("div",{class:"flex flex-row items-center",style:{background:"green",lineHeight:"var(--body-line-height)",paddingLeft:"0.25rem",paddingRight:"0.25rem",borderRadius:"4px",color:"white"}},m("svg",{class:"blink",style:{width:"1rem",height:"1rem",marginRight:"0.25rem"},xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},m("circle",{cx:"12",cy:"12",r:"10"}),m("polyline",{points:"12 6 12 12 16 14"})),m("div",null,e.formatDuration(e.entryDuration([e.startedAt]))))),e.log.toReversed().map(t=>m("div",{class:"flex flex-row",style:{marginBottom:"2px"}},m("div",{class:"grow"},e.formatEntry(t)),m("div",{class:"flex flex-row items-center",style:{background:"#aaa",lineHeight:"var(--body-line-height)",paddingLeft:"0.25rem",paddingRight:"0.25rem",borderRadius:"4px",color:"white"}},m("svg",{style:{width:"1rem",height:"1rem",marginRight:"0.25rem"},xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},m("circle",{cx:"12",cy:"12",r:"10"}),m("polyline",{points:"12 6 12 12 16 14"})),m("div",null,e.formatDuration(e.entryDuration(t))))))))}};var Z=class{constructor(){this.auth=null,this.files=new ce,window.MiniSearch?this.index=new re:this.index=new le}};a(Z,"BrowserBackend");var re=class{constructor(){this.indexer=new MiniSearch({idField:"ID",fields:["ID","Name","Value","Value.markdown"],storeFields:["ID"],extractField:(e,t)=>t.split(".").reduce((n,o)=>n&&n[o],e)})}index(e){this.indexer.has(e.ID)?this.indexer.replace(e):this.indexer.add(e)}remove(e){try{this.indexer.discard(e)}catch{}}search(e){let t=this.indexer.autoSuggest(e);return t.length===0?[]:this.indexer.search(t[0].suggestion,{prefix:!0,combineWith:"AND"}).map(n=>n.ID)}};a(re,"SearchIndex_MiniSearch");var le=class{constructor(){this.nodes={}}index(e){this.nodes[e.ID]=e.Name}remove(e){delete this.nodes[e]}search(e){let t=[];for(let n in this.nodes)this.nodes[n].includes(e)&&t.push(n);return t}};a(le,"SearchIndex_Dumb");var ce=class{async readFile(e){return localStorage.getItem(`treehouse:${e}`)}async writeFile(e,t){localStorage.setItem(`treehouse:${e}`,t)}};a(ce,"FileStore");import{encode as tt,decode as nt}from"https://cdn.jsdelivr.net/npm/js-base64@3.7.5/base64.mjs";var ue=class{constructor(e,t,n){this.loginURL=e,this.clientFactory=t,this.auth=this,this.shas={},this.opts=Object.assign({domain:"treehouse.sh",checkDomain:!1,privateRepo:!1},n||{});let o=new Z;this.index=o.index,this.files=o.files}get repoName(){return`${this.user?.userID().toLowerCase()}.${this.opts.domain}`}async initialize(){let e=new URL(location.href).searchParams.get("code");if(e)try{let i=location.search.replace(/\bcode=\w+/,"").replace(/\?$/,"");history.pushState({},"",`${location.pathname}${i}`);let l=await(await fetch(this.loginURL,{method:"POST",mode:"cors",headers:{"content-type":"application/json"},body:JSON.stringify({code:e})})).json();if(l.error)throw l.error;localStorage.setItem("treehouse:gh-token",l.token)}catch(i){this.reset(),console.error(i);return}let t=new URL(location.href).searchParams.get("access_token");if(t)try{let i=location.search.replace(/\baccess_token=\w+/,"").replace(/\?$/,"");history.pushState({},"",`${location.pathname}${i}`),localStorage.setItem("treehouse:gh-token",t)}catch(i){this.reset(),console.error(i);return}try{if(await this.authenticate(),!this.user)throw"authentication failed"}catch(i){console.error(i),this.opts.authFallbackURL&&(location.href=this.opts.authFallbackURL);return}if(this.opts.checkDomain&&this.repoName!==location.hostname.toLowerCase()){location.hostname=this.repoName;return}try{await this.client.rest.repos.get({owner:this.user.userID(),repo:this.repoName})}catch(i){if(i.message!=="Not Found")throw i;console.log("Creating repository...");let s=await this.client.rest.repos.createForAuthenticatedUser({name:this.repoName,private:this.opts.privateRepo});if(s.status!==201){console.error(s);return}}try{await this.client.rest.repos.getContent({owner:this.user.userID(),repo:this.repoName,path:"workspace.json"})}catch(i){if(i.name!=="HttpError")throw i;console.log("Creating workspace.json...");let s=await this.client.rest.repos.createOrUpdateFileContents({owner:this.user.userID(),repo:this.repoName,path:"workspace.json",message:"initial commit",content:btoa(JSON.stringify([]))});if(s.status!==201){console.error(s);return}}this.files=this;let n=ot();await this.readFile("treehouse.lock"),await this.writeFile("treehouse.lock",n);let o=setInterval(async()=>{await this.readFile("treehouse.lock")!==n&&(clearInterval(o),document.dispatchEvent(new CustomEvent("BackendError")),console.warn("lock stolen!"))},5e3)}async loadExtensions(){try{if((await this.client.rest.repos.getContent({owner:this.user?.userID(),repo:this.repoName,path:"",random:Math.random().toString(36).substring(2)})).data.find(t=>t.type==="dir"&&t.name==="ext")){let t=await this.client.rest.repos.getContent({owner:this.user?.userID(),repo:this.repoName,path:"ext",random:Math.random().toString(36).substring(2)});for(let n of t.data)if(n.name.endsWith(".css")){let o=await this.client.rest.repos.getContent({owner:this.user?.userID(),repo:this.repoName,path:n.path,random:Math.random().toString(36).substring(2)}),i=document.createElement("link");i.setAttribute("href",`data:text/css;charset=utf-8;base64,${o.data.content}`),i.setAttribute("rel","stylesheet"),i.setAttribute("type","text/css"),document.head.appendChild(i)}else if(n.name.endsWith(".js")){let o=await this.client.rest.repos.getContent({owner:this.user?.userID(),repo:this.repoName,path:n.path,random:Math.random().toString(36).substring(2)}),i=document.createElement("script");i.setAttribute("type","module"),i.setAttribute("src",`data:text/javascript;charset=utf-8;base64,${o.data.content}`),document.head.appendChild(i)}}}catch{}}async authenticate(){let e=localStorage.getItem("treehouse:gh-token");if(!e)return;this.client=new this.clientFactory({auth:e});let t=await this.client.rest.users.getAuthenticated();!t||t.error||(this.user=new pe(t.data),m&&m.redraw())}currentUser(){return this.user}login(){location.assign(this.loginURL)}reset(){localStorage.removeItem("treehouse:gh-token"),this.user=null,m&&m.redraw()}logout(){this.reset(),location.reload()}async readFile(e){try{let t=await this.client.rest.repos.getContent({owner:this.user?.userID(),repo:this.repoName,path:e,random:Math.random().toString(36).substring(2)});return this.shas[e]=t.data.sha,nt(t.data.content)}catch(t){return t.name!=="HttpError"&&console.error(t),null}}async writeFile(e,t){let n=await this.client.rest.repos.createOrUpdateFileContents({owner:this.user?.userID(),repo:this.repoName,path:e,message:"autosave",content:tt(t),sha:this.shas[e]});this.shas[e]=n.data.content.sha}};a(ue,"GitHubBackend");var pe=class{constructor(e){this.user=e}userID(){return this.user.login}displayName(){return this.user.name}avatarURL(){return this.user.avatar_url}};a(pe,"User");function ot(){let r=Date.now().toString(36),e=Math.random().toString(36).substring(2);return r+e}a(ot,"uniqueID");async function ri(r,e,t){t.initialize&&await t.initialize();let n=new G(t);window.workbench=n,await n.initialize(),[N,U,j,C,T,A,O,H].forEach(o=>{o.initialize&&o.initialize(n)}),r.addEventListener("BackendError",()=>{n.showNotice("lockstolen",()=>{location.reload()})}),n.commands.registerCommand({id:"cut",title:"Cut",when:o=>{if(!o.node)return!1;let i=n.getInput(o.path);return i&&i.selectionStart===i.selectionEnd?!0:(n.clipboard=void 0,!1)},action:o=>{n.clipboard={op:"cut",node:o.node}}}),n.keybindings.registerBinding({command:"cut",key:"meta+x"}),n.commands.registerCommand({id:"copy",title:"Copy",when:o=>{if(!o.node)return!1;let i=n.getInput(o.path);return i&&i.selectionStart===i.selectionEnd?!0:(n.clipboard=void 0,!1)},action:o=>{n.clipboard={op:"copy",node:o.node}}}),n.keybindings.registerBinding({command:"copy",key:"meta+c"}),n.commands.registerCommand({id:"copy-reference",title:"Copy as Reference",when:o=>{if(!o.node)return!1;let i=n.getInput(o.path);return i&&i.selectionStart===i.selectionEnd?!0:(n.clipboard=void 0,!1)},action:o=>{n.clipboard={op:"copyref",node:o.node}}}),n.keybindings.registerBinding({command:"copy-reference",key:"shift+ctrl+c"}),n.commands.registerCommand({id:"paste",title:"Paste",when:o=>!!n.clipboard,action:o=>{if(!o.node||o.path.previous&&M(o.path.previous))return;switch(n.clipboard.op){case"copy":n.clipboard.node=n.clipboard.node.duplicate();break;case"copyref":let s=n.workspace.new("");s.refTo=n.clipboard.node,n.clipboard.node=s;break}n.clipboard.node.raw.Rel==="Fields"?(n.clipboard.node.raw.Parent=o.node.parent.id,o.node.parent.addLinked("Fields",n.clipboard.node)):(n.clipboard.node.parent=o.node.parent,n.clipboard.node.siblingIndex=o.node.siblingIndex),m.redraw.sync();let i=o.path.clone();i.pop(),n.focus(i.append(n.clipboard.node))}}),n.keybindings.registerBinding({command:"paste",key:"meta+v"}),n.commands.registerCommand({id:"view-list",title:"View as List",when:o=>!(!o.node||o.node.raw.Rel==="Fields"||o.node.parent&&o.node.parent.hasComponent(C)),action:o=>{o.node.setAttr("view","list")}}),n.commands.registerCommand({id:"view-table",title:"View as Table",when:o=>!(!o.node||o.node.raw.Rel==="Fields"||o.node.parent&&o.node.parent.hasComponent(C)),action:o=>{o.node.setAttr("view","table"),o.node.children.forEach(i=>{n.workspace.setExpanded(o.path.head,i,!1)})}}),n.commands.registerCommand({id:"view-tabs",title:"View as Tabs",when:o=>!(!o.node||o.node.raw.Rel==="Fields"||o.node.parent&&o.node.parent.hasComponent(C)),action:o=>{o.node.setAttr("view","tabs")}}),n.commands.registerCommand({id:"add-checkbox",title:"Add checkbox",when:o=>!(!o.node||o.node.raw.Rel==="Fields"||o.node.parent&&o.node.parent.hasComponent(C)),action:o=>{let i=new T;o.node.addComponent(i)}}),n.commands.registerCommand({id:"remove-checkbox",title:"Remove checkbox",when:o=>!o.node||o.node.raw.Rel==="Fields"||o.node.parent&&o.node.parent.hasComponent(C)?!1:!!o.node.hasComponent(T),action:o=>{o.node.removeComponent(T)}}),n.commands.registerCommand({id:"create-field",title:"Create Field",action:o=>{if(!o.node||o.node.childCount>0||o.node.componentCount>0||o.path.previous&&M(o.path.previous))return;let i=o.path.clone();i.pop();let s=n.workspace.new(o.node.name,"");s.raw.Parent=o.node.parent.id;let l=new U;s.addComponent(l),o.node.parent.addLinked("Fields",s),i.push(s),o.node.destroy(),m.redraw.sync(),n.focus(i)}}),n.commands.registerCommand({id:"mark-done",title:"Mark Done",when:o=>!(!o.node||o.node.raw.Rel==="Fields"||o.node.parent&&o.node.parent.hasComponent(C)),action:o=>{if(o.node)if(o.node.hasComponent(T)){let i=o.node.getComponent(T);i.checked?o.node.removeComponent(T):(i.checked=!0,o.node.changed())}else{let i=new T;o.node.addComponent(i)}}}),n.keybindings.registerBinding({command:"mark-done",key:"meta+enter"}),n.commands.registerCommand({id:"expand",title:"Expand",action:o=>{o.node&&(n.workspace.setExpanded(o.path.head,o.node,!0),m.redraw())}}),n.keybindings.registerBinding({command:"expand",key:"meta+arrowdown"}),n.commands.registerCommand({id:"collapse",title:"Collapse",action:o=>{o.node&&(n.workspace.setExpanded(o.path.head,o.node,!1),m.redraw())}}),n.keybindings.registerBinding({command:"collapse",key:"meta+arrowup"}),n.commands.registerCommand({id:"indent",title:"Indent",when:o=>!(!o.node||o.node.raw.Rel==="Fields"||o.node.parent&&o.node.parent.hasComponent(C)),action:o=>{let i=o.node,s=o.path.clone(),l=i.prevSibling;for(;l&&M(l);)if(l=l.prevSibling,!l)return;l!==null&&(s.pop(),s.push(l),i.parent=l,s.push(i),n.workspace.setExpanded(o.path.head,l,!0),m.redraw.sync(),n.focus(s))}}),n.keybindings.registerBinding({command:"indent",key:"tab"}),n.commands.registerCommand({id:"outdent",title:"Outdent",when:o=>!(!o.node||o.node.raw.Rel==="Fields"||o.path.previous&&M(o.path.previous)||o.node.parent&&o.node.parent.hasComponent(C)),action:o=>{let i=o.node,s=o.path.previous,l=o.path.clone();s!==null&&s.id!=="@root"&&s.id!==n.workspace.lastOpenedID&&(l.pop(),l.pop(),i.parent=s.parent,l.push(i),i.siblingIndex=s.siblingIndex+1,s.childCount===0&&s.getLinked("Fields").length===0&&n.workspace.setExpanded(o.path.head,s,!1),m.redraw.sync(),n.focus(l))}}),n.keybindings.registerBinding({command:"outdent",key:"shift+tab"}),n.commands.registerCommand({id:"move-up",title:"Move Up",action:o=>{if(!o.node)return;let i=o.node,s=i.parent;if(s!==null&&s.id!=="@root"){let l=s.childCount;if(i.siblingIndex===0){if(!s.prevSibling)return;let d=o.path.clone();d.pop(),d.pop();let u=s.prevSibling;for(;u&&M(u);)if(u=u.prevSibling,!u)return;d.push(u),d.push(i),i.parent=u,i.siblingIndex=u.childCount-1,n.workspace.setExpanded(o.path.head,u,!0),m.redraw.sync(),n.focus(d)}else{if(l===1)return;i.siblingIndex=i.siblingIndex-1,m.redraw.sync()}}}}),n.keybindings.registerBinding({command:"move-up",key:"shift+meta+arrowup"}),n.commands.registerCommand({id:"move-down",title:"Move Down",action:o=>{if(!o.node)return;let i=o.node,s=i.parent;if(s!==null&&s.id!=="@root"){let l=s.childCount;if(i.siblingIndex===l-1){if(!s.nextSibling)return;let d=o.path.clone();d.pop(),d.pop();let u=s.nextSibling;for(;u&&M(u);)if(u=u.nextSibling,!u)return;d.push(u),d.push(i),i.parent=u,i.siblingIndex=0,n.workspace.setExpanded(o.path.head,u,!0),m.redraw.sync(),n.focus(d)}else{if(l===1)return;i.siblingIndex=i.siblingIndex+1,m.redraw.sync()}}}}),n.keybindings.registerBinding({command:"move-down",key:"shift+meta+arrowdown"}),n.commands.registerCommand({id:"insert-child",title:"Insert Child",action:(o,i="",s)=>{if(!o.node||M(o.node))return;let l=n.workspace.new(i);l.parent=o.node,s!==void 0&&(l.siblingIndex=s),n.workspace.setExpanded(o.path.head,o.node,!0),m.redraw.sync(),n.focus(o.path.append(l),i.length)}}),n.commands.registerCommand({id:"insert-before",title:"Insert Before",action:o=>{if(!o.node||o.path.previous&&M(o.path.previous))return;let i=n.workspace.new("");i.parent=o.node.parent,i.siblingIndex=o.node.siblingIndex,m.redraw.sync();let s=o.path.clone();s.pop(),n.focus(s.append(i))}}),n.commands.registerCommand({id:"insert",title:"Insert Node",action:(o,i="")=>{if(!o.node||o.path.previous&&M(o.path.previous))return;let s=n.workspace.new(i);s.parent=o.node.parent,s.siblingIndex=o.node.siblingIndex+1,m.redraw.sync();let l=o.path.clone();l.pop(),n.focus(l.append(s))}}),n.keybindings.registerBinding({command:"insert",key:"shift+enter"}),n.commands.registerCommand({id:"create-reference",title:"Create Reference",action:o=>{if(!o.node||o.path.previous&&M(o.path.previous))return;let i=n.workspace.new("");i.parent=o.node.parent,i.siblingIndex=o.node.siblingIndex+1,i.refTo=o.node,m.redraw.sync();let s=o.path.clone();s.pop(),n.focus(s.append(i))}}),n.commands.registerCommand({id:"delete",title:"Delete Node",action:o=>{if(!o.node||o.node.id.startsWith("@")||o.path.previous&&M(o.path.previous))return;let i=n.workspace.findAbove(o.path);if(o.node.destroy(),m.redraw.sync(),i){let s=0;o.event&&o.event.key==="Backspace"&&(i.node.value?s=i.node.value.length:s=i.node.name.length),i.node.childCount===0&&n.workspace.setExpanded(o.path.head,i.node,!1),n.focus(i,s)}}}),n.keybindings.registerBinding({command:"delete",key:"shift+meta+backspace"}),n.commands.registerCommand({id:"prev",title:"Previous Node",action:o=>{if(!o.node)return;let i=n.workspace.findAbove(o.path);i&&n.focus(i)}}),n.keybindings.registerBinding({command:"prev",key:"arrowup"}),n.commands.registerCommand({id:"next",title:"Next Node",action:o=>{if(!o.node)return;let i=n.workspace.findBelow(o.path);i&&n.focus(i)}}),n.keybindings.registerBinding({command:"next",key:"arrowdown"}),n.commands.registerCommand({id:"pick-command",title:"Command Palette",hidden:!0,when:o=>!n.isDialogOpen(),action:o=>{let i=o.node,s=o.path,l=!1;i||(i=o.path.head,s=new R(o.path.head,o.path.name),l=!0);let d=n.getInput(s),u=d.getBoundingClientRect(),h=r.body.scrollLeft+u.x+d.selectionStart*10+20,p=r.body.scrollTop+u.y-8;d.coordsAtCursor&&(h=d.coordsAtCursor.left-17,p=d.coordsAtCursor.top-16),l&&(h=r.body.scrollLeft+u.x,p=r.body.scrollTop+u.y+u.height),n.showPalette(h,p,n.newContext({node:i}))}}),n.keybindings.registerBinding({command:"pick-command",key:"meta+k"}),n.commands.registerCommand({id:"new-panel",title:"Open in New Panel",action:o=>{o.node&&(n.openNewPanel(o.node),m.redraw())}}),n.commands.registerCommand({id:"close-panel",title:"Close Panel",action:(o,i)=>{n.closePanel(i||o.path),n.context.path=n.mainPanel,m.redraw()}}),n.commands.registerCommand({id:"zoom",title:"Open",action:o=>{n.workspace.lastOpenedID=o.node.id,n.workspace.save(),n.context.path=o.path.append(o.node),n.panels[0]=n.context.path,m.redraw()}}),n.commands.registerCommand({id:"generate-random",hidden:!0,title:"Generate Random Children",action:o=>{o.node&&[...Array(100)].forEach(()=>{let i=n.workspace.new(it(8));i.parent=o.node})}}),n.menus.registerMenu("node",[{command:"zoom"},{command:"new-panel"},{command:"cut"},{command:"copy"},{command:"paste"},{command:"indent"},{command:"outdent"},{command:"move-up"},{command:"move-down"},{command:"delete"}]),n.menus.registerMenu("settings",[{title:()=>`${n.backend.auth?.currentUser()?.userID()} @ GitHub`,disabled:!0,when:()=>n.authenticated()},{title:()=>"Login with GitHub",when:()=>!n.authenticated(),onclick:()=>{localStorage.getItem("github")?n.backend.auth.login():n.showNotice("github",()=>{n.backend.auth.login()})}},{title:()=>"Reset Demo",when:()=>!n.authenticated(),onclick:()=>{localStorage.clear(),location.reload()}},{title:()=>"Settings",onclick:()=>n.showSettings()},{title:()=>"Documentation",onclick:()=>window.open("https://treehouse.sh/docs/user","_blank")},{title:()=>"Submit Issue",onclick:()=>window.open("https://github.com/treehousedev/treehouse/issues","_blank")},{title:()=>"Logout",when:()=>n.authenticated(),onclick:()=>n.backend.auth.logout()}]),r.addEventListener("keydown",o=>{let i=n.keybindings.evaluateEvent(o);if(i&&n.canExecuteCommand(i.command,n.context)){n.executeCommand(i.command,n.context),o.stopPropagation(),o.preventDefault();return}}),m.mount(e,{view:()=>m(He,{workbench:n})})}a(ri,"setup");function it(r=10){let e=a((o,i)=>Math.round(Math.random()*(i-o)+o),"random"),t=a(()=>{let o=["got","ability","shop","recall","fruit","easy","dirty","giant","shaking","ground","weather","lesson","almost","square","forward","bend","cold","broken","distant","adjective"];return o[e(0,o.length-1)]},"word");return a(o=>[...Array(o)].map((i,s)=>t()).join(" ").trim(),"words")(e(2,r))}a(it,"generateName");export{Z as BrowserBackend,ue as GitHubBackend,re as SearchIndex_MiniSearch,ri as setup};
//# sourceMappingURL=treehouse.min.js.map
